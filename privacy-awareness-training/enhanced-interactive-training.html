<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GRC Engineering: Privacy Awareness Training</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    :root {
      --primary-purple:#7B2CBF; --light-purple:#E0B0FF; --dark-purple:#4A1A6B;
      --primary-teal:#06A77D; --light-teal:#B2F5E8; --dark-teal:#045F4A;
      --primary-off-black:#17191E; --primary-white:#FFFFFF; --success-green:#4CAF50;
      --warning-amber:#FF9800; --error-red:#F44336; --neutral-gray:#9E9E9E;
      --light-gray:#F5F5F5; --medium-gray:#E0E0E0; --primary-gradient: linear-gradient(135deg, #7B2CBF 0%, #06A77D 100%);
    }
    
    body { 
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background: #0a0e27;
      color:var(--primary-off-black); 
      min-height:100vh; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      padding:20px; 
      line-height:1.6;
      overflow-x: hidden;
    }
    
    /* Static gradient background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 50%, rgba(123,44,191,0.15) 0%, transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(123,44,191,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 20%, rgba(0,85,204,0.1) 0%, transparent 50%);
      z-index: -1;
    }
    
    .module-container { 
      background:var(--primary-white); 
      border-radius:16px; 
      box-shadow:0 10px 40px rgba(0,8,77,.25); 
      max-width:1100px; 
      width:100%; 
      overflow:hidden;
    }
    
    .grc-header { 
      background:var(--primary-gradient); 
      padding:20px 32px; 
      display:flex; 
      align-items:center; 
      justify-content:space-between; 
      color:var(--primary-white);
      position: relative;
      overflow: hidden;
    }
    
    .grc-logo { 
      display:flex; 
      align-items:center; 
      gap:16px; 
      font-weight:700; 
      font-size:20px;
      z-index: 2;
    }
    
    .grc-owl { 
      width:48px; 
      height:48px; 
      background:var(--primary-white); 
      border-radius:12px; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-size:28px;
      animation: bounce 2s ease-in-out infinite;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .grc-owl:hover {
      transform: rotate(10deg) scale(1.1);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    
    .progress-bar { 
      height:6px; 
      background:var(--medium-gray); 
      position:relative; 
      overflow:hidden; 
    }
    
    .progress-fill { 
      height:100%; 
      background:var(--primary-gradient); 
      width:0%; 
      transition:width .5s ease;
      box-shadow: 0 0 10px rgba(123,44,191,0.5);
    }
    
    .slide { 
      padding:56px 48px; 
      min-height:580px; 
      display:none; 
      animation:slideIn .4s ease;
      position: relative;
    }
    
    .slide.active { display:block; }
    
    @keyframes slideIn { 
      from{ opacity:0; transform:translateX(30px); } 
      to{ opacity:1; transform:translateX(0); } 
    }
    
    /* Hide slide content briefly during restoration */
    .slide.restoring {
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    h1 { 
      color:var(--dark-purple); 
      font-size:2.5rem; 
      font-weight:800; 
      margin-bottom:24px; 
      text-align:center; 
      line-height:1.2; 
    }
    
    h2 { 
      color:var(--dark-purple); 
      font-size:2rem; 
      font-weight:700; 
      margin-bottom:24px; 
    }
    
    p { 
      font-size:1.125rem; 
      margin-bottom:20px; 
      color:var(--primary-off-black); 
      line-height:1.7;
    }
    
    .intro-animation {
      font-size: 120px;
      text-align: center;
      margin: 40px 0;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .info-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin: 32px 0;
    }
    
    .info-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 2px solid var(--medium-gray);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .info-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      border-color: var(--primary-purple);
    }
    
    .info-card-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }
    
    .info-card h3 {
      color: var(--dark-purple);
      font-size: 1.25rem;
      margin-bottom: 12px;
    }
    
    .navigation { 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      margin-top:40px; 
      padding-top:32px; 
      border-top:2px solid var(--medium-gray); 
    }
    
    .btn { 
      background:var(--primary-gradient); 
      color:var(--primary-white); 
      padding:14px 28px; 
      border:none; 
      border-radius:8px; 
      font-size:1rem; 
      font-weight:600; 
      cursor:pointer; 
      transition:all .3s ease; 
      margin:8px; 
      display:inline-flex; 
      align-items:center; 
      gap:8px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn:hover { 
      transform:translateY(-2px); 
      box-shadow:0 6px 20px rgba(123,44,191,.3); 
    }
    
    .btn-secondary { 
      background:transparent; 
      color:var(--primary-purple); 
      border:2px solid var(--primary-purple); 
    }
    
    .btn-secondary:hover { 
      background:var(--light-purple); 
      border-color:var(--dark-purple); 
      color:var(--dark-purple); 
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ff3b30, #ff6b60);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4CAF50, #66BB6A);
    }
    
    .btn:disabled, .btn.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Watering hole simulator */
    .website-simulator {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 0;
      margin: 24px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    .browser-bar {
      background: #2d2d2d;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid #444;
    }
    
    .browser-controls {
      display: flex;
      gap: 8px;
    }
    
    .browser-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ff5f57;
    }
    
    .browser-dot:nth-child(2) { background: #ffbd2e; }
    .browser-dot:nth-child(3) { background: #28ca42; }
    
    .url-bar {
      flex: 1;
      background: #1a1a1a;
      color: #888;
      padding: 6px 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    
    .suspicious-url {
      color: #ff3b30;
      font-weight: bold;
    }
    
    .website-content {
      background: #fff;
      padding: 32px;
      min-height: 300px;
      position: relative;
    }
    
    .fake-popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      text-align: center;
      display: none;
      z-index: 10;
      border: 3px solid #ff3b30;
    }
    
    .fake-popup.show {
      display: block;
      animation: popIn 0.3s ease;
    }
    
    @keyframes popIn {
      from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    /* Interactive decision buttons */
    .decision-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
      position: relative;
      z-index: 50;
    }
    
    .decision-btn {
      background: #fff;
      border: 2px solid #e0e0e0;
      padding: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      text-align: center;
      position: relative;
    }
    
    .decision-btn:hover {
      background: var(--light-purple);
      border-color: var(--primary-purple);
      box-shadow: 0 4px 12px rgba(123,44,191,0.2);
      transform: translateY(-2px);
    }
    
    .decision-btn.selected {
      background: var(--light-purple);
      border-color: var(--primary-purple);
      font-weight: 600;
    }
    
    .decision-btn.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Specific styles for GDPR buttons to prevent overlap */
    .gdpr-btn {
      position: relative !important;
      z-index: 1;
      isolation: isolate;
      margin: 0 !important;
    }
    
    .gdpr-btn:disabled {
      pointer-events: none;
      transform: none !important;
    }
    
    /* Detection challenge */
    .detection-challenge {
      background: #f8f9fa;
      border: 2px solid var(--medium-gray);
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
    }
    
    .site-card {
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin: 12px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .site-card:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .site-card.selected {
      border-color: var(--primary-purple);
      background: var(--light-purple);
    }
    
    .site-card.correct {
      border-color: var(--success-green);
      background: rgba(76,175,80,0.1);
    }
    
    .site-card.incorrect {
      border-color: var(--error-red);
      background: rgba(244,67,54,0.1);
    }
    
    .url-display {
      font-family: monospace;
      font-size: 14px;
      color: #666;
      margin-top: 8px;
      padding: 4px 8px;
      background: #f0f0f0;
      border-radius: 4px;
      display: inline-block;
    }
    
    /* Gamification elements */
    .achievement {
      position: fixed;
      top: 20px;
      right: -500px;
      background: #fff;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 16px;
      transition: right 0.5s ease;
      z-index: 1000;
      pointer-events: none;
    }
    
    .achievement.show {
      right: 20px;
      pointer-events: auto;
    }
    
    .achievement-icon {
      font-size: 32px;
      animation: celebrate 0.5s ease;
    }
    
    @keyframes celebrate {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
    }
    
    .score-display {
      background: linear-gradient(135deg, #7B2CBF, #06A77D);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      font-size: 1.2rem;
      box-shadow: 0 4px 12px rgba(123,44,191,0.3);
    }
    
    /* Certificate */
    .certificate {
      text-align: center;
      padding: 48px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 16px;
      border: 3px solid var(--primary-purple);
      position: relative;
      overflow: hidden;
    }
    
    .certificate::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(123,44,191,0.1), transparent);
      animation: shine 3s linear infinite;
    }
    
    @keyframes shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }
    
    .certificate-seal {
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
      position: relative;
      animation: sealRotate 20s linear infinite;
    }
    
    @keyframes sealRotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .trophy-icon {
      font-size: 80px;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      animation: trophyGlow 2s ease-in-out infinite;
    }
    
    @keyframes trophyGlow {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
      display: none;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--primary-purple);
      animation: confettiFall 3s linear;
    }
    
    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    
    /* SCORM status indicator */
    .scorm-status {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: rgba(23,25,30,.9);
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: .75rem;
      display: none;
      backdrop-filter: blur(10px);
    }
    
    /* Feedback styles */
    .feedback {
      padding: 16px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 16px;
      display: none;
    }
    
    .feedback.correct {
      background: #d4edda;
      color: #155724;
      border: 2px solid var(--success-green);
    }
    
    .feedback.incorrect {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid var(--error-red);
    }
    
    .feedback.warning {
      background: #fff3cd;
      color: #856404;
      border: 2px solid #ffc107;
    }
    
    /* Responsive */
    @media (max-width:768px) {
      .slide { padding:32px 24px; }
      h1 { font-size:2rem; }
      h2 { font-size:1.5rem; }
      .decision-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- Achievement Popup -->
  <div class="achievement" id="achievementPopup">
    <div class="achievement-icon" id="achievementIcon">🏆</div>
    <div>
      <div style="font-weight:700; color:var(--dark-purple);" id="achievementTitle">Achievement Unlocked!</div>
      <div style="font-size:14px; color:#6c757d;" id="achievementText">You're making great progress!</div>
    </div>
  </div>

  <!-- Confetti Container -->
  <div class="confetti-container" id="confettiContainer"></div>

  <div class="module-container">
    <div class="grc-header">
      <div class="grc-logo">
        <div class="grc-owl" onclick="owlClick()">👾</div>
        <span>Privacy Awareness Training</span>
      </div>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>

    <!-- Slide 1: Welcome -->
    <div class="slide active" id="slide1">
      <h1>🔐 Privacy Awareness Training</h1>
      <div class="intro-animation">🔒</div>
      <p style="text-align:center; font-size:1.4rem; margin-bottom:24px; color:#7B2CBF; font-weight:600;">
        Master Privacy Protection
      </p>
      
      <div style="background:#f0f7ff; padding:24px; border-radius:12px; margin:20px auto; max-width:700px; border:1px solid #d0e4ff;">
        <p style="font-size:1.1rem; color:#333; margin-bottom:16px; font-weight:600;">
          In this training you will learn:
        </p>
        <ul style="text-align:left; font-size:1rem; color:#555; line-height:1.8; max-width:500px; margin:0 auto; list-style:none;">
          <li>📇 <strong>Privacy Basics:</strong> What is PII, why it matters, and common risks</li>
          <li>🗂️ <strong>Data Handling:</strong> Classification, secure sharing, and retention</li>
          <li>🌍 <strong>GDPR/CCPA:</strong> Key requirements and compliance red flags</li>
          <li>🎯 <strong>Interactive Simulations:</strong> Test your knowledge with real scenarios</li>
        </ul>
      </div>
      
      <div class="navigation">
        <span></span>
        <button class="btn" onclick="startTraining()">Begin Training →</button>
      </div>
    </div>

    <!-- Slide 2: Privacy Basics Concepts -->
    <div class="slide" id="slide2">
      <h2 style="text-align:center; margin-bottom:30px;">🔐 Privacy Basics</h2>
      
      <div style="background:linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%); padding:25px; border-radius:12px; margin-bottom:25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color:var(--dark-purple); margin-bottom:20px; font-size:1.3rem;">📇 What is Personal Information (PII)?</h3>
        <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;">
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">👤</span>
            Names & Emails
          </div>
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">🌐</span>
            IP Addresses
          </div>
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">📍</span>
            Location Data
          </div>
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">💳</span>
            Financial Info
          </div>
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">🏥</span>
            Health Records
          </div>
          <div style="background:#fff; padding:12px 16px; border-radius:8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align:center; font-size:0.95rem;">
            <span style="font-size:1.2rem; display:block; margin-bottom:4px;">📱</span>
            Device IDs
          </div>
        </div>
      </div>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px;">
        <div style="background:linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding:24px; border-radius:12px; box-shadow: 0 2px 8px rgba(76,175,80,0.2);">
          <h3 style="color:#1b5e20; margin-bottom:16px; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
            <span style="font-size:1.4rem;">✅</span> Why Privacy Matters
          </h3>
          <ul style="margin:0; padding:0; list-style:none; color:#2e7d32; font-size:0.95rem;">
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Trust:</strong> Builds customer confidence
            </li>
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Compliance:</strong> GDPR/CCPA requirements
            </li>
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Security:</strong> Reduces breach impact
            </li>
            <li style="padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Responsibility:</strong> It's the right thing to do
            </li>
          </ul>
        </div>
        
        <div style="background:linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); padding:24px; border-radius:12px; box-shadow: 0 2px 8px rgba(244,67,54,0.2);">
          <h3 style="color:#b71c1c; margin-bottom:16px; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
            <span style="font-size:1.4rem;">⚠️</span> Common Privacy Risks
          </h3>
          <ul style="margin:0; padding:0; list-style:none; color:#c62828; font-size:0.95rem;">
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Over-collection:</strong> Taking unnecessary data
            </li>
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Retention:</strong> Keeping data too long
            </li>
            <li style="margin-bottom:10px; padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Sharing:</strong> Unauthorized disclosure
            </li>
            <li style="padding-left:24px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Transfer:</strong> Unsecured transmission
            </li>
          </ul>
        </div>
      </div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Continue →</button>
      </div>
    </div>

    <!-- Slide 3: Privacy Basics - PII Fishing Game -->
    <div class="slide" id="slide3">
      <h2 style="text-align:center; margin-bottom:20px;">🎣 PII Fishing: Keep Our Data Ocean Clean</h2>
      <p style="text-align:center; color:#666; margin-bottom:25px;">Help keep the data ocean safe! Identify and remove Personal Identifiable Information (PII) before it floats into the wrong hands.</p>
      
      <!-- Game Container -->
      <div style="position:relative; background: linear-gradient(180deg, #87CEEB 0%, #4682B4 50%, #1e3a5f 95%, #0f1e33 100%); border-radius:16px; height:500px; overflow:hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
        
        <!-- Game Stats Bar -->
        <div style="position:absolute; top:0; left:0; right:0; background:rgba(255,255,255,0.95); padding:15px; display:flex; justify-content:space-between; align-items:center; z-index:100; border-bottom:2px solid #4682B4;">
          <div style="display:flex; gap:30px;">
            <div>
              <span style="color:#666; font-size:14px;">Score:</span>
              <span id="fishingScore" style="font-size:24px; font-weight:bold; color:#4CAF50; margin-left:5px;">0</span>
            </div>
            <div>
              <span style="color:#666; font-size:14px;">PII Caught:</span>
              <span id="piiCaught" style="font-size:24px; font-weight:bold; color:#1976d2; margin-left:5px;">0</span>
            </div>
            <div>
              <span style="color:#666; font-size:14px;">Mistakes:</span>
              <span id="mistakes" style="font-size:24px; font-weight:bold; color:#f44336; margin-left:5px;">0</span>
            </div>
          </div>
          <div id="timerDisplay" style="font-size:20px; font-weight:bold; color:#ff6b6b;">
            ⏱️ <span id="timeLeft">15</span>s
          </div>
        </div>
        
        <!-- Ocean/Game Area -->
        <div id="fishingOcean" style="position:absolute; top:70px; left:0; right:0; bottom:0; cursor:crosshair;">
          <!-- Animated waves effect -->
          <div style="position:absolute; bottom:0; left:0; right:0; height:120px; background:linear-gradient(180deg, transparent 0%, rgba(30,58,95,0.2) 50%, rgba(15,30,51,0.4) 100%); pointer-events:none;">
            <div class="ocean-wave" style="position:absolute; bottom:20px; width:200%; height:60px; background: linear-gradient(180deg, rgba(135,206,235,0.15), rgba(70,130,180,0.1)); animation: wave 12s linear infinite; border-radius: 50% 50% 0 0;"></div>
            <div class="ocean-wave" style="position:absolute; bottom:10px; width:200%; height:40px; background: linear-gradient(180deg, rgba(100,149,237,0.1), rgba(30,58,95,0.08)); animation: wave 15s linear infinite reverse; border-radius: 40% 60% 0 0;"></div>
          </div>
          
          <!-- Instructions overlay (shows at start) -->
          <div id="instructionsOverlay" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(255,255,255,0.95); padding:30px; border-radius:12px; text-align:center; z-index:200; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <h3 style="color:#1976d2; margin-bottom:15px;">🎣 How to Play</h3>
            <p style="margin-bottom:10px;">Click on Personal Identifiable Information (PII) to catch it!</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:20px 0; text-align:left;">
              <div style="padding:10px; background:#e8f5e9; border-radius:8px;">
                <strong style="color:#2e7d32;">✅ PII Examples:</strong>
                <ul style="margin:5px 0 0 20px; font-size:14px;">
                  <li>Email addresses</li>
                  <li>Social Security Numbers</li>
                  <li>Phone numbers</li>
                  <li>Credit card numbers</li>
                </ul>
              </div>
              <div style="padding:10px; background:#ffebee; border-radius:8px;">
                <strong style="color:#c62828;">❌ Not PII:</strong>
                <ul style="margin:5px 0 0 20px; font-size:14px;">
                  <li>Company names</li>
                  <li>Product names</li>
                  <li>Country names</li>
                  <li>Generic titles</li>
                </ul>
              </div>
            </div>
            <button class="btn" onclick="startFishingGame()">Start Fishing! 🎣</button>
          </div>
        </div>
        
        <!-- Success/Fail Feedback Bubbles -->
        <div id="feedbackBubbles" style="position:absolute; top:70px; left:0; right:0; bottom:0; pointer-events:none; z-index:150;"></div>
      </div>
      
      <!-- Results Screen (hidden initially) -->
      <div id="fishingResults" style="display:none; margin-top:20px; padding:20px; background:linear-gradient(135deg, #e3f2fd, #ffffff); border-radius:12px; border:2px solid #1976d2;">
        <h3 style="color:#1976d2; text-align:center; margin-bottom:15px;">🏆 Results</h3>
        <div id="resultsContent"></div>
      </div>
      
      <!-- Feedback area -->
      <div id="privacyBasicsFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()" id="privacyBasicsContinue" style="display:none;">Continue →</button>
      </div>
      
      <style>
        @keyframes wave {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
        
        @keyframes swim {
          0%, 100% { transform: translateX(0) translateY(0); }
          25% { transform: translateX(10px) translateY(-5px); }
          75% { transform: translateX(-10px) translateY(5px); }
        }
        
        @keyframes float-up {
          0% { transform: translateY(0); opacity: 1; }
          100% { transform: translateY(-50px); opacity: 0; }
        }
        
        .fish-item {
          position: absolute;
          padding: 8px 16px;
          background: rgba(255,255,255,0.9);
          border-radius: 20px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-size: 14px;
          font-weight: 600;
          box-shadow: 0 2px 10px rgba(0,0,0,0.2);
          animation: swim 3s ease-in-out infinite;
          user-select: none;
        }
        
        .fish-item:hover {
          transform: scale(1.1);
          box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .fish-item.pii {
          border: 2px solid #ff6b6b;
          background: linear-gradient(135deg, #ffe0e0, #ffffff);
        }
        
        .fish-item.not-pii {
          border: 2px solid #4CAF50;
          background: linear-gradient(135deg, #e8f5e9, #ffffff);
        }
        
        .fish-item.caught {
          animation: float-up 1s ease-out forwards;
          pointer-events: none;
        }
        
        .feedback-bubble {
          position: absolute;
          padding: 10px 15px;
          border-radius: 20px;
          font-weight: bold;
          animation: float-up 1.5s ease-out forwards;
          pointer-events: none;
          z-index: 200;
        }
        
        .feedback-bubble.correct {
          background: #4CAF50;
          color: white;
        }
        
        .feedback-bubble.wrong {
          background: #f44336;
          color: white;
        }
      </style>
    </div>

    <!-- Slide 4: Data Handling Best Practices -->
    <div class="slide" id="slide4">
      <h2 style="text-align:center; margin-bottom:30px;">🔐 Data Handling Best Practices</h2>
      
      <!-- Data Lifecycle -->
      <div style="background:linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%); padding:25px; border-radius:12px; margin-bottom:25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color:var(--dark-purple); margin-bottom:20px; text-align:center; font-size:1.3rem;">📊 The Data Lifecycle</h3>
        <div style="display:grid; grid-template-columns:repeat(5, 1fr); gap:12px;">
          <div style="background:#fff; padding:15px 10px; border-radius:8px; text-align:center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <span style="font-size:1.5rem; display:block; margin-bottom:8px;">📥</span>
            <strong style="color:var(--dark-purple); display:block; margin-bottom:4px;">Collect</strong>
            <span style="font-size:0.85rem; color:#666;">Only what's needed</span>
          </div>
          <div style="background:#fff; padding:15px 10px; border-radius:8px; text-align:center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <span style="font-size:1.5rem; display:block; margin-bottom:8px;">🏷️</span>
            <strong style="color:var(--dark-purple); display:block; margin-bottom:4px;">Classify</strong>
            <span style="font-size:0.85rem; color:#666;">Label sensitivity</span>
          </div>
          <div style="background:#fff; padding:15px 10px; border-radius:8px; text-align:center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <span style="font-size:1.5rem; display:block; margin-bottom:8px;">💾</span>
            <strong style="color:var(--dark-purple); display:block; margin-bottom:4px;">Store</strong>
            <span style="font-size:0.85rem; color:#666;">Secure & encrypted</span>
          </div>
          <div style="background:#fff; padding:15px 10px; border-radius:8px; text-align:center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <span style="font-size:1.5rem; display:block; margin-bottom:8px;">🔄</span>
            <strong style="color:var(--dark-purple); display:block; margin-bottom:4px;">Use/Share</strong>
            <span style="font-size:0.85rem; color:#666;">Need-to-know basis</span>
          </div>
          <div style="background:#fff; padding:15px 10px; border-radius:8px; text-align:center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <span style="font-size:1.5rem; display:block; margin-bottom:8px;">🗑️</span>
            <strong style="color:var(--dark-purple); display:block; margin-bottom:4px;">Dispose</strong>
            <span style="font-size:0.85rem; color:#666;">Secure deletion</span>
          </div>
        </div>
      </div>
      
      <!-- Key Principles Grid -->
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:25px;">
        <div style="background:linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding:20px; border-radius:12px; box-shadow: 0 2px 8px rgba(76,175,80,0.2);">
          <h3 style="color:#1b5e20; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:1.3rem;">✅</span> DO's
          </h3>
          <ul style="margin:0; padding:0; list-style:none; color:#2e7d32; font-size:0.95rem;">
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Encrypt</strong> sensitive data at rest & in transit
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Use MFA</strong> for accessing sensitive systems
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Apply least privilege</strong> access controls
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Audit logs</strong> for all data access
            </li>
            <li style="padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Regular reviews</strong> of access permissions
            </li>
          </ul>
        </div>
        
        <div style="background:linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); padding:20px; border-radius:12px; box-shadow: 0 2px 8px rgba(244,67,54,0.2);">
          <h3 style="color:#b71c1c; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
            <span style="font-size:1.3rem;">🚫</span> DON'Ts
          </h3>
          <ul style="margin:0; padding:0; list-style:none; color:#c62828; font-size:0.95rem;">
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Never</strong> store passwords in plain text
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Avoid</strong> personal email/cloud accounts
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Don't share</strong> credentials or access tokens
            </li>
            <li style="margin-bottom:8px; padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Never bypass</strong> security controls
            </li>
            <li style="padding-left:20px; position:relative;">
              <span style="position:absolute; left:0;">•</span>
              <strong>Don't keep</strong> data beyond retention period
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Quick Reference -->
      <div style="background:#fff3cd; padding:20px; border-radius:12px; border:2px solid #ffc107; text-align:center;">
        <p style="margin:0; color:#856404; font-weight:600;">
          🔑 <strong>Golden Rule:</strong> If you wouldn't want your own data handled this way, don't do it with others' data!
        </p>
      </div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Next →</button>
      </div>
    </div>

    <!-- Slide 5: Data Handling - Drag and Drop -->
    <div class="slide" id="slide5">
      <h2 style="text-align:center; margin-bottom:20px;">🗂️ Data Storage Challenge</h2>
      <p style="text-align:center; margin-bottom:25px; font-size:1.1rem;">Drag each data type to the appropriate storage solution</p>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:20px;">
        <!-- Data Types Section -->
        <div>
          <h3 style="color:var(--dark-purple); margin-bottom:15px; font-size:1.1rem;">📋 Data Types to Store</h3>
          <div id="dataItems" style="background:#f8f9fa; padding:20px; border-radius:12px; min-height:300px;">
            <div class="draggable-item" draggable="true" data-type="meeting-notes" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
              <span style="font-size:1.2rem; margin-right:8px;">📝</span>
              <strong>Meeting Notes</strong>
              <div style="font-size:0.85rem; color:#666; margin-top:4px;">Team standup summary, no PII</div>
            </div>
            <div class="draggable-item" draggable="true" data-type="customer-data" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
              <span style="font-size:1.2rem; margin-right:8px;">👥</span>
              <strong>Customer Database</strong>
              <div style="font-size:0.85rem; color:#666; margin-top:4px;">10K records with PII & financials</div>
            </div>
            <div class="draggable-item" draggable="true" data-type="passwords" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
              <span style="font-size:1.2rem; margin-right:8px;">🔑</span>
              <strong>API Keys & Passwords</strong>
              <div style="font-size:0.85rem; color:#666; margin-top:4px;">Production credentials</div>
            </div>
            <div class="draggable-item" draggable="true" data-type="project-docs" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
              <span style="font-size:1.2rem; margin-right:8px;">📊</span>
              <strong>Project Roadmap</strong>
              <div style="font-size:0.85rem; color:#666; margin-top:4px;">Internal team planning docs</div>
            </div>
          </div>
        </div>
        
        <!-- Storage Solutions Section -->
        <div>
          <h3 style="color:var(--dark-purple); margin-bottom:15px; font-size:1.1rem;">💾 Storage Solutions</h3>
          <div style="display:grid; gap:12px;">
            <div class="drop-zone" data-storage="notes" style="background:linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); padding:20px; border-radius:12px; min-height:70px; border:2px dashed #ef5350; transition:all 0.3s;">
              <div style="font-weight:600; color:#c62828; margin-bottom:4px;">❌ Personal Laptop Storage</div>
              <div style="font-size:0.85rem; color:#d32f2f;">Non-company device, no encryption, no backup</div>
              <div class="dropped-items" style="margin-top:10px;"></div>
            </div>
            <div class="drop-zone" data-storage="personal-cloud" style="background:linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding:20px; border-radius:12px; min-height:70px; border:2px dashed #ff9800; transition:all 0.3s;">
              <div style="font-weight:600; color:#e65100; margin-bottom:4px;">⚠️ Personal Cloud Storage Solution (GDrive, Dropbox, etc.)</div>
              <div style="font-size:0.85rem; color:#ef6c00;">Personal account, basic security</div>
              <div class="dropped-items" style="margin-top:10px;"></div>
            </div>
            <div class="drop-zone" data-storage="corporate" style="background:linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding:20px; border-radius:12px; min-height:70px; border:2px dashed #2196f3; transition:all 0.3s;">
              <div style="font-weight:600; color:#0d47a1; margin-bottom:4px;">✓ Company GDrive/Notion</div>
              <div style="font-size:0.85rem; color:#1565c0;">Approved tools, access controls</div>
              <div class="dropped-items" style="margin-top:10px;"></div>
            </div>
            <div class="drop-zone" data-storage="encrypted" style="background:linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding:20px; border-radius:12px; min-height:70px; border:2px dashed #4caf50; transition:all 0.3s;">
              <div style="font-weight:600; color:#1b5e20; margin-bottom:4px;">✅ Encrypted Cloud Storage</div>
              <div style="font-size:0.85rem; color:#2e7d32;">Enterprise encryption, audit logs</div>
              <div class="dropped-items" style="margin-top:10px;"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div style="text-align:center; margin:20px 0;">
        <button class="btn" onclick="checkDataPlacement()" id="checkPlacementBtn">Check My Answers</button>
        <button class="btn" onclick="resetDataPlacement()" style="background:transparent; color:var(--primary-purple); border:2px solid var(--primary-purple);">Reset</button>
      </div>
      
      <div id="dataHandlingFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()" id="dataHandlingContinue" style="display:none;">Continue →</button>
      </div>
    </div>

    <!-- Slide 6: GDPR/CCPA Concepts -->
    <div class="slide" id="slide6">
      <h2 style="text-align:center; margin-bottom:30px;">
        <span style="background: linear-gradient(135deg, #1976d2, #42a5f5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          Global Privacy Regulations
        </span>
      </h2>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:28px;">
        <!-- GDPR Card -->
        <div style="background: linear-gradient(135deg, #ffffff 0%, #f3f7ff 100%); border-radius:16px; padding:24px; box-shadow: 0 4px 20px rgba(123,44,191,0.15); position:relative; overflow:hidden;">
          <div style="position:absolute; top:0; left:0; right:0; height:4px; background: linear-gradient(90deg, #003399, #0066cc, #003399);"></div>
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
            <div style="width:48px; height:48px; background:linear-gradient(135deg, #1e88e5, #1565c0); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; box-shadow: 0 3px 10px rgba(21,101,192,0.3);">
              🇪🇺
            </div>
            <h3 style="color:#0d47a1; margin:0; font-size:1.2rem;">GDPR Requirements</h3>
          </div>
          <div style="space-y:8px;">
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#1976d2; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Lawful basis for processing</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#1976d2; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Right to access, rectify, delete</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#1976d2; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Data portability</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#1976d2; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">72-hour breach notification</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <span style="color:#1976d2; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Privacy by design</span>
            </div>
          </div>
        </div>
        
        <!-- CCPA Card -->
        <div style="background: linear-gradient(135deg, #ffffff 0%, #f0f9f4 100%); border-radius:16px; padding:24px; box-shadow: 0 4px 20px rgba(76,175,80,0.15); position:relative; overflow:hidden;">
          <div style="position:absolute; top:0; left:0; right:0; height:4px; background: linear-gradient(90deg, #2e7d32, #4caf50, #2e7d32);"></div>
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
            <div style="width:48px; height:48px; background:linear-gradient(135deg, #66bb6a, #43a047); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; box-shadow: 0 3px 10px rgba(67,160,71,0.3);">
              🇺🇸
            </div>
            <h3 style="color:#2e7d32; margin:0; font-size:1.2rem;">CCPA Requirements</h3>
          </div>
          <div style="space-y:8px;">
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#43a047; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Right to know what's collected</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#43a047; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Right to delete personal info</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#43a047; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Right to opt-out of sale</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px; margin-bottom:8px;">
              <span style="color:#43a047; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Non-discrimination</span>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <span style="color:#43a047; font-size:16px; margin-top:2px;">✓</span>
              <span style="color:#424242; font-size:15px;">Clear privacy notices</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Red Flags Section with animated warning -->
      <div style="background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%); border-radius:16px; padding:24px; box-shadow: 0 4px 20px rgba(244,67,54,0.1); border: 2px solid #ffcdd2; position:relative;">
        <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
          <div style="width:40px; height:40px; background:linear-gradient(135deg, #ff5252, #f44336); border-radius:10px; display:flex; align-items:center; justify-content:center; animation: pulse 2s infinite;">
            ⚠️
          </div>
          <h3 style="color:#c62828; margin:0; font-size:1.1rem; font-weight:600;">Critical Red Flags to Watch For</h3>
        </div>
        
        <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:16px;">
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">🚫 Collecting without consent</span>
          </div>
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">🗑️ Ignoring deletion requests</span>
          </div>
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">📢 Sharing without notice</span>
          </div>
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">❌ No opt-out mechanism</span>
          </div>
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">⏰ Delayed breach reporting</span>
          </div>
          <div style="background:white; padding:12px; border-radius:8px; border-left:3px solid #ef5350;">
            <span style="color:#d32f2f; font-weight:500; font-size:14px;">♾️ Keeping data forever</span>
          </div>
        </div>
      </div>
      
      <style>
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }
      </style>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Continue →</button>
      </div>
    </div>

    <!-- Slide 7: GDPR/CCPA - Valid Request Identification -->
    <div class="slide" id="slide7">
      <h2 style="text-align:center; margin-bottom:25px;">⚖️ GDPR/CCPA Request Validation</h2>
      <p style="text-align:center; color:#666; margin-bottom:25px;">Review these customer requests and determine if they're valid under GDPR/CCPA regulations.</p>
      
      <!-- Request Review Interface -->
      <div style="background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 16px; padding: 25px; box-shadow: 0 6px 30px rgba(0,0,0,0.1); margin-bottom: 25px;">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px; padding-bottom:15px; border-bottom:2px solid #e9ecef;">
          <div style="width:50px; height:50px; background:linear-gradient(135deg, #1976d2, #42a5f5); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px;">
            📋
          </div>
          <div>
            <h3 style="margin:0; color:#1a237e;">Privacy Request Review</h3>
            <p style="margin:0; color:#666; font-size:14px;">Evaluate 3 customer requests for GDPR/CCPA compliance</p>
          </div>
        </div>
        
        <!-- Request Tabs -->
        <div id="requestTabs" style="display:flex; gap:10px; margin-bottom:20px;">
          <button onclick="showRequest(1)" class="request-tab active" style="padding:10px 20px; background:#1976d2; color:white; border:none; border-radius:8px 8px 0 0; cursor:pointer; font-weight:600;">
            📝 Request #1
          </button>
          <button onclick="showRequest(2)" class="request-tab" style="padding:10px 20px; background:#e3f2fd; color:#1976d2; border:none; border-radius:8px 8px 0 0; cursor:pointer; font-weight:600;">
            📝 Request #2
          </button>
          <button onclick="showRequest(3)" class="request-tab" style="padding:10px 20px; background:#e3f2fd; color:#1976d2; border:none; border-radius:8px 8px 0 0; cursor:pointer; font-weight:600;">
            📝 Request #3
          </button>
        </div>
        
        <!-- Request 1: Invalid - Too Broad -->
        <div id="requestContent1" class="request-content" style="display:block;">
          <div style="background:white; border-radius:12px; padding:20px; border:2px solid #e3f2fd;">
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:15px;">
              <div>
                <p style="margin:0; color:#666; font-size:14px;"><strong>From:</strong> randomuser@gmail.com</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Location:</strong> Unknown</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Account Status:</strong> No account found</p>
              </div>
              <span style="background:#9e9e9e; color:white; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:600;">DELETION REQUEST</span>
            </div>
            <div style="background:#f5f5f5; padding:15px; border-radius:8px; margin-bottom:15px;">
              <p style="margin:0; color:#333; line-height:1.6; font-style:italic;">
                "Delete all my data from all systems immediately. I don't have an account but I know you have my data somewhere. 
                Also delete my data from all your partners and subsidiaries worldwide."
              </p>
            </div>
            <div style="background:#e3f2fd; padding:12px; border-radius:8px; border-left:4px solid #1976d2;">
              <p style="margin:0; color:#0d47a1; font-size:14px;">
                <strong>🔍 Key Details:</strong>
                <br>• No account or email match found
                <br>• No specific data identified
                <br>• Requesting deletion from third parties we don't control
              </p>
            </div>
          </div>
        </div>
        
        <!-- Request 2: Valid - Proper CCPA -->
        <div id="requestContent2" class="request-content" style="display:none;">
          <div style="background:white; border-radius:12px; padding:20px; border:2px solid #e3f2fd;">
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:15px;">
              <div>
                <p style="margin:0; color:#666; font-size:14px;"><strong>From:</strong> john.doe@company.com</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Location:</strong> California, USA</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Account Status:</strong> Active the service Pro</p>
              </div>
              <span style="background:#ff9800; color:white; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:600;">ACCESS REQUEST</span>
            </div>
            <div style="background:#f5f5f5; padding:15px; border-radius:8px; margin-bottom:15px;">
              <p style="margin:0; color:#333; line-height:1.6; font-style:italic;">
                "Under CCPA, I request a copy of all personal information the company has collected about me in the past 12 months, 
                including categories of sources, purposes of collection, and any third parties you've shared it with. 
                My account email is john.doe@company.com."
              </p>
            </div>
            <div style="background:#e8f5e9; padding:12px; border-radius:8px; border-left:4px solid #4caf50;">
              <p style="margin:0; color:#2e7d32; font-size:14px;">
                <strong>✅ Valid Elements:</strong>
                <br>• California resident (CCPA applies)
                <br>• Specific account identified
                <br>• Proper CCPA data access request format
                <br>• 12-month lookback period is correct
              </p>
            </div>
          </div>
        </div>
        
        <!-- Request 3: Invalid - Wrong Basis -->
        <div id="requestContent3" class="request-content" style="display:none;">
          <div style="background:white; border-radius:12px; padding:20px; border:2px solid #e3f2fd;">
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:15px;">
              <div>
                <p style="margin:0; color:#666; font-size:14px;"><strong>From:</strong> competitor@rivalcompany.com</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Location:</strong> Germany (EU)</p>
                <p style="margin:0; color:#666; font-size:14px;"><strong>Account Status:</strong> Free tier account</p>
              </div>
              <span style="background:#f44336; color:white; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:600;">DATA PORTABILITY</span>
            </div>
            <div style="background:#f5f5f5; padding:15px; border-radius:8px; margin-bottom:15px;">
              <p style="margin:0; color:#333; line-height:1.6; font-style:italic;">
                "Under GDPR Article 20, I demand you provide me with a complete copy of your entire customer database 
                in machine-readable format. I need this for 'research purposes' and since GDPR gives me data portability rights, 
                you must comply within 30 days."
              </p>
            </div>
            <div style="background:#ffebee; padding:12px; border-radius:8px; border-left:4px solid #f44336;">
              <p style="margin:0; color:#c62828; font-size:14px;">
                <strong>🚫 Red Flags:</strong>
                <br>• Data portability only covers THEIR data, not others'
                <br>• Requesting entire customer database (not their data)
                <br>• Competitor email domain suggests bad faith
                <br>• Misrepresenting GDPR Article 20 scope
              </p>
            </div>
          </div>
        </div>
        
        <!-- Validation Buttons -->
        <div style="margin-top:20px; padding-top:20px; border-top:2px solid #e9ecef;">
          <p style="color:#666; font-weight:600; margin-bottom:15px; text-align:center;">Is this a valid GDPR/CCPA request that we must honor?</p>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; max-width:500px; margin:0 auto;">
            <button class="decision-btn gdpr-btn" onclick="gdprDecision('valid')" data-choice="valid" style="background:linear-gradient(135deg, #66bb6a, #4caf50); color:white; border:none; padding:16px 24px; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s; font-size:16px;">
              ✅ Valid Request
            </button>
            <button class="decision-btn gdpr-btn" onclick="gdprDecision('invalid')" data-choice="invalid" style="background:linear-gradient(135deg, #ef5350, #f44336); color:white; border:none; padding:16px 24px; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s; font-size:16px;">
              ❌ Not Valid
            </button>
          </div>
        </div>
      </div>
      
      <script>
        function showRequest(num) {
          // Hide all requests
          document.querySelectorAll('.request-content').forEach(content => {
            content.style.display = 'none';
          });
          // Remove active class from all tabs
          document.querySelectorAll('.request-tab').forEach(tab => {
            tab.style.background = '#e3f2fd';
            tab.style.color = '#1976d2';
          });
          // Show selected request
          document.getElementById('requestContent' + num).style.display = 'block';
          // Mark tab as active
          event.target.style.background = '#1976d2';
          event.target.style.color = 'white';
          // Store current request for decision handling
          window.currentRequestScenario = num;
          
          // Save the current tab state
          gameState.choices['gdpr_current_tab'] = num;
          saveChoice('gdpr_current_tab', num);
          
          // Show stored feedback for this tab if it exists
          const feedbackDiv = document.getElementById('gdprFeedback');
          if (feedbackDiv) {
            if (window.gdprFeedbackStorage && window.gdprFeedbackStorage[`request_${num}`]) {
              feedbackDiv.innerHTML = window.gdprFeedbackStorage[`request_${num}`];
            } else {
              feedbackDiv.innerHTML = '';
            }
          }
          
          // Restore button states if this request was answered
          const choice = gameState.choices && gameState.choices[`gdpr_request_${num}`];
          if (choice) {
            const buttons = document.querySelectorAll('#slide7 .decision-btn');
            buttons.forEach(btn => {
              btn.disabled = true;
              btn.style.cursor = 'not-allowed';
              if (btn.getAttribute('data-choice') === choice) {
                btn.style.opacity = '1';
                btn.style.transform = 'scale(1.02)';
                btn.style.boxShadow = '0 6px 20px rgba(0,0,0,0.2)';
              } else {
                btn.style.opacity = '0.5';
              }
            });
          } else {
            // Re-enable buttons if not answered
            const buttons = document.querySelectorAll('#slide7 .decision-btn');
            buttons.forEach(btn => {
              btn.disabled = false;
              btn.style.cursor = 'pointer';
              btn.style.opacity = '1';
              btn.style.transform = 'scale(1)';
              btn.style.boxShadow = '';
            });
          }
        }
        // Initialize to first request only if not already set
        if (!window.currentRequestScenario) {
          window.currentRequestScenario = 1;
        }
      </script>
      
      <div id="gdprFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="completeTraining()" id="gdprContinue" style="display:none;">Complete Training →</button>
      </div>
    </div>

    <!-- Slide 8: Certificate -->
    <div class="slide" id="slide8">
      <div class="certificate">
        <div class="trophy-icon">🏆</div>
        <h1 style="color:var(--primary-purple); margin:24px 0;">Privacy Champion!</h1>
        <p style="font-size:1.25rem; color:var(--dark-purple); margin-bottom:32px;">
          You've mastered essential privacy protection practices!
        </p>
        
        <div style="margin:32px 0;">
          <div>
            <div style="font-size:2rem; font-weight:700; color:var(--primary-purple);" id="finalScore">100%</div>
            <div style="color:#6c757d;">Final Score</div>
          </div>
        </div>
        
        <p style="color:var(--primary-purple); font-weight:600; font-size:1.125rem;">
          Stay Vigilant. Stay Secure. 👾
        </p>
        
        <button class="btn" onclick="window.close()" style="margin-top:24px;">Exit Training</button>
      </div>
    </div>
  </div>

  <div class="scorm-status" id="scormStatus">SCORM: Disconnected</div>

  <script>
    // SCORM API wrapper
    var scorm = {
      version: null, api: null,
      init: function() {
        try {
          this.api = this.getAPI();
          if (this.api) {
            this.version = this.getVersion();
            var result = this.api.LMSInitialize ? this.api.LMSInitialize("") : this.api.Initialize("");
            if (result == "true") {
              this.setStatus("initialized");
              this.setValue("cmi.core.lesson_status", "incomplete");
              this.setValue("cmi.core.score.min", "0");
              this.setValue("cmi.core.score.max", "100");
              this.setValue("cmi.core.score.raw", "0");
              this.commit();
              return true;
            }
          }
        } catch(e) { console.log("SCORM API not available - standalone mode"); }
        return false;
      },
      getAPI: function() {
        var api=null; if (window.parent && window.parent!=window) api=this.findAPI(window.parent);
        if (!api && window.opener) api=this.findAPI(window.opener);
        if (!api) api=this.findAPI(window);
        return api;
      },
      findAPI: function(win) {
        var i=0; while(!win.API && !win.API_1484_11 && win.parent && win.parent!=win && i<500){ i++; win=win.parent; }
        return win.API || win.API_1484_11;
      },
      getVersion: function(){ if(this.api){ if(this.api.LMSInitialize) return "1.2"; if(this.api.Initialize) return "2004";} return null; },
      getValue: function(e){ if(!this.api) return ""; return this.version=="1.2"? this.api.LMSGetValue(e): this.api.GetValue(e); },
      setValue: function(e,v){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSSetValue(e,v): this.api.SetValue(e,v); },
      commit: function(){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSCommit(""): this.api.Commit(""); },
      finish: function(){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSFinish(""): this.api.Terminate(""); },
      setStatus: function(status){ var el=document.getElementById('scormStatus'); if(el){ el.textContent='SCORM: '+status; el.style.display='block'; } }
    };
    
    // Game state management
    let gameState = {
      currentSlide: 1,
      totalSlides: 8,
      userScore: 0,
      achievements: [],
      privacyBasicsComplete: false,
      dataHandlingComplete: false,
      gdprComplete: false,
      scenariosCompleted: 0,
      totalScenarios: 4,
      choices: {}
    };
    
    
    // Achievement system
    function showAchievement(icon, title, text) {
      const popup = document.getElementById('achievementPopup');
      document.getElementById('achievementIcon').textContent = icon;
      document.getElementById('achievementTitle').textContent = title;
      document.getElementById('achievementText').textContent = text;
      
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 3000);
    }
    
    // Privacy Basics Decision Handler
    // PII Fishing Game Functions
    let fishingGameActive = false;
    let fishingTimer = null;
    let fishingScore = 0;
    let piiCaughtCount = 0;
    let mistakesCount = 0;
    let timeRemaining = 15;
    let fishItems = [];
    let fishingGameCompleted = false;
    
    // PII and Non-PII data examples
    const piiExamples = [
      "Email: john.doe@email.com",
      "Phone: 555-123-4567",
      "SSN: 123-45-6789",
      "Credit Card: 4532-1234-5678-9012",
      "Email: sarah@gmail.com",
      "Mobile: (408) 555-0123",
      "SSN: 987-65-4321",
      "Card: 5105-1051-0510-5100",
      "Email: mike.smith@company.com",
      "Phone: +1-555-987-6543",
      "Birth Date: 01/15/1985",
      "Social Security: 111-22-3333",
      "Driver License: D1234567",
      "Passport: M1234567",
      "IP Address: 192.168.1.100",
      "Medical ID: MED123456",
      "Email: jane_doe@company.com",
      "Account ID: ACC789456",
      "Device ID: DEV-2023-8475",
      "Employee ID: EMP00123",
      "Tax ID: 12-3456789",
      "Bank Account: 0012345678",
      "Home Address: 123 Main St",
      "Patient ID: PAT-2024-789"
    ];
    
    const nonPiiExamples = [
      "Company: TechCorp",
      "Country: United States",
      "Job Title: Software Engineer",
      "State: California",
      "Role: Product Manager",
      "Version: 3.0",
      "Product: Container",
      "Tool: Kubernetes",
      "Service: Cloud Platform",
      "Type: API Documentation",
      "License: Open Source",
      "Method: DevOps",
      "Architecture: Microservices",
      "Process: CI/CD Pipeline",
      "OS: Linux",
      "System: Database",
      "Layer: Frontend",
      "Layer: Backend",
      "Department: Engineering",
      "Building: Tower A",
      "Floor: Level 3",
      "City: San Francisco",
      "Language: Python",
      "Framework: React"
    ];
    
    // Track all used items during this game session
    let availablePii = [];
    let availableNonPii = [];
    
    function startFishingGame() {
      // Check if game was already completed - restore final state
      if (fishingGameCompleted && gameState.choices && gameState.choices['fishing_game_completed']) {
        const savedState = gameState.choices['fishing_game_state'];
        if (savedState) {
          restoreFishingGameState(savedState);
          return;
        }
      }
      
      // Reset game state
      fishingGameActive = true;
      fishingScore = 0;
      piiCaughtCount = 0;
      mistakesCount = 0;
      timeRemaining = 15;
      fishItems = [];
      fishingGameCompleted = false;
      
      // Create fresh copies of the arrays for this game session
      availablePii = [...piiExamples];
      availableNonPii = [...nonPiiExamples];
      
      // Shuffle both arrays for better randomization
      shuffleArray(availablePii);
      shuffleArray(availableNonPii);
      
      // Hide instructions
      document.getElementById('instructionsOverlay').style.display = 'none';
      
      // Update display
      document.getElementById('fishingScore').textContent = '0';
      document.getElementById('piiCaught').textContent = '0';
      document.getElementById('mistakes').textContent = '0';
      document.getElementById('timeLeft').textContent = '15';
      
      // Start spawning fish
      spawnFishContinuously();
      
      // Start timer
      fishingTimer = setInterval(() => {
        timeRemaining--;
        document.getElementById('timeLeft').textContent = timeRemaining;
        
        if (timeRemaining <= 0) {
          endFishingGame();
        }
      }, 1000);
    }
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    
    function spawnFishContinuously() {
      if (!fishingGameActive) return;
      
      // Spawn a new fish
      spawnFish();
      
      // Schedule next spawn (random interval between 0.5 and 1.5 seconds)
      setTimeout(() => spawnFishContinuously(), 500 + Math.random() * 1000);
    }
    
    function getUniqueItem(isPii) {
      let data = null;
      
      // Check if we need to refill the arrays
      if (availablePii.length === 0 && availableNonPii.length === 0) {
        // Both arrays empty, refill and reshuffle
        availablePii = [...piiExamples];
        availableNonPii = [...nonPiiExamples];
        shuffleArray(availablePii);
        shuffleArray(availableNonPii);
      }
      
      if (isPii) {
        if (availablePii.length > 0) {
          data = availablePii.shift();
        } else if (availableNonPii.length > 0) {
          // PII ran out, use non-PII instead
          data = availableNonPii.shift();
          isPii = false;
        }
      } else {
        if (availableNonPii.length > 0) {
          data = availableNonPii.shift();
        } else if (availablePii.length > 0) {
          // Non-PII ran out, use PII instead
          data = availablePii.shift();
          isPii = true;
        }
      }
      
      return data ? { data, isPii } : null;
    }
    
    function spawnFish() {
      const ocean = document.getElementById('fishingOcean');
      
      // Decide if we want PII or not (50% chance of PII)
      const wantPii = Math.random() < 0.5;
      const result = getUniqueItem(wantPii);
      
      // If we've used all items, stop spawning
      if (!result) return;
      
      const { data, isPii } = result;
      
      const fish = document.createElement('div');
      fish.className = `fish-item ${isPii ? 'pii' : 'not-pii'}`;
      fish.textContent = data;
      fish.dataset.isPii = isPii;
      
      // Random position (avoid edges)
      const maxX = ocean.offsetWidth - 200;
      const maxY = ocean.offsetHeight - 100;
      fish.style.left = (20 + Math.random() * maxX) + 'px';
      fish.style.top = (20 + Math.random() * maxY) + 'px';
      
      // Random swim animation duration
      fish.style.animationDuration = (2 + Math.random() * 3) + 's';
      
      // Click handler
      fish.onclick = function() {
        catchFish(this, isPii);
      };
      
      ocean.appendChild(fish);
      fishItems.push(fish);
      
      // Remove fish after 8 seconds if not caught
      setTimeout(() => {
        if (fish.parentNode) {
          fish.remove();
          fishItems = fishItems.filter(f => f !== fish);
        }
      }, 8000);
    }
    
    function catchFish(fishElement, isPii) {
      if (!fishingGameActive) return;
      
      fishElement.classList.add('caught');
      
      // Create feedback bubble
      const bubble = document.createElement('div');
      bubble.className = 'feedback-bubble';
      const rect = fishElement.getBoundingClientRect();
      const container = document.getElementById('feedbackBubbles');
      const containerRect = container.getBoundingClientRect();
      
      bubble.style.left = (rect.left - containerRect.left + rect.width/2 - 50) + 'px';
      bubble.style.top = (rect.top - containerRect.top) + 'px';
      
      if (isPii) {
        // Correct catch
        bubble.className += ' correct';
        bubble.textContent = '+10 PII Caught!';
        fishingScore += 10;
        piiCaughtCount++;
        document.getElementById('fishingScore').textContent = fishingScore;
        document.getElementById('piiCaught').textContent = piiCaughtCount;
      } else {
        // Wrong catch
        bubble.className += ' wrong';
        bubble.textContent = '-5 Not PII!';
        fishingScore = Math.max(0, fishingScore - 5);
        mistakesCount++;
        document.getElementById('fishingScore').textContent = fishingScore;
        document.getElementById('mistakes').textContent = mistakesCount;
      }
      
      container.appendChild(bubble);
      
      // Remove bubble after animation
      setTimeout(() => bubble.remove(), 1500);
      
      // Remove fish from tracking
      fishItems = fishItems.filter(f => f !== fishElement);
    }
    
    function endFishingGame() {
      fishingGameActive = false;
      clearInterval(fishingTimer);
      fishingGameCompleted = true;
      
      // Clear remaining fish
      fishItems.forEach(fish => fish.remove());
      fishItems = [];
      
      // Save game state
      const gameStateToSave = {
        score: fishingScore,
        piiCaught: piiCaughtCount,
        mistakes: mistakesCount,
        timeUsed: 15 - timeRemaining,
        completed: true
      };
      
      gameState.choices['fishing_game_completed'] = true;
      gameState.choices['fishing_game_state'] = gameStateToSave;
      saveChoice('fishing_game_completed', true);
      saveChoice('fishing_game_state', gameStateToSave);
      
      // Calculate performance
      const accuracy = piiCaughtCount > 0 ? 
        Math.round(((piiCaughtCount / (piiCaughtCount + mistakesCount)) * 100)) : 0;
      
      // Show results
      const resultsDiv = document.getElementById('fishingResults');
      const resultsContent = document.getElementById('resultsContent');
      
      let resultHTML = `
        <div style="text-align:center;">
          <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:20px; margin-bottom:20px;">
            <div style="background:#e3f2fd; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#1976d2;">${fishingScore}</div>
              <div style="color:#666;">Final Score</div>
            </div>
            <div style="background:#e8f5e9; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#4caf50;">${piiCaughtCount}</div>
              <div style="color:#666;">PII Removed</div>
            </div>
            <div style="background:#fff3e0; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#ff9800;">${accuracy}%</div>
              <div style="color:#666;">Accuracy</div>
            </div>
          </div>
      `;
      
      if (accuracy >= 80) {
        resultHTML += `
          <div style="background:#e8f5e9; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#2e7d32; margin:0 0 10px 0;">🎉 Excellent PII Detection!</h4>
            <p style="margin:0; color:#555;">You successfully identified and removed ${piiCaughtCount} pieces of PII from the data ocean. Great job protecting privacy!</p>
            <button class="btn btn-secondary" onclick="resetFishingGame()" style="margin-top:15px;">🎮 Play Again</button>
          </div>
        `;
        gameState.privacyBasicsComplete = true;
        document.getElementById('privacyBasicsContinue').style.display = 'inline-block';
      } else if (accuracy >= 60) {
        resultHTML += `
          <div style="background:#fff3e0; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#e65100; margin:0 0 10px 0;">⚠️ Good Effort!</h4>
            <p style="margin:0; color:#555;">You caught ${piiCaughtCount} PII items but made ${mistakesCount} mistakes. Remember: PII includes emails, SSNs, phone numbers, and credit cards.</p>
            <button class="btn btn-secondary" onclick="resetFishingGame()" style="margin-top:15px;">🎮 Play Again</button>
          </div>
        `;
        gameState.privacyBasicsComplete = true;
        document.getElementById('privacyBasicsContinue').style.display = 'inline-block';
      } else {
        resultHTML += `
          <div style="background:#ffebee; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#c62828; margin:0 0 10px 0;">❌ Keep Practicing!</h4>
            <p style="margin:0 0 10px 0; color:#555;">You need more practice identifying PII. Remember:</p>
            <ul style="margin:5px 0 0 20px; color:#666; text-align:left;">
              <li>PII = Personal data that identifies someone</li>
              <li>Not PII = Company names, products, generic terms</li>
            </ul>
            <button class="btn" onclick="resetFishingGame()" style="margin-top:15px;">Try Again 🎣</button>
          </div>
        `;
      }
      
      resultHTML += '</div>';
      resultsContent.innerHTML = resultHTML;
      resultsDiv.style.display = 'block';
      
      // Show achievement for high scores
      if (fishingScore >= 100) {
        showAchievement('🎣', 'PII Hunter', 'Caught 100+ points of PII!');
      }
    }
    
    function resetFishingGame() {
      // Clear saved state
      fishingGameCompleted = false;
      delete gameState.choices['fishing_game_completed'];
      delete gameState.choices['fishing_game_state'];
      
      // Hide results
      document.getElementById('fishingResults').style.display = 'none';
      
      // Show instructions again
      document.getElementById('instructionsOverlay').style.display = 'block';
    }
    
    function restoreFishingGameState(savedState) {
      // Hide instructions
      document.getElementById('instructionsOverlay').style.display = 'none';
      
      // Restore scores
      fishingScore = savedState.score || 0;
      piiCaughtCount = savedState.piiCaught || 0;
      mistakesCount = savedState.mistakes || 0;
      
      // Update display
      document.getElementById('fishingScore').textContent = fishingScore;
      document.getElementById('piiCaught').textContent = piiCaughtCount;
      document.getElementById('mistakes').textContent = mistakesCount;
      document.getElementById('timeLeft').textContent = '0';
      
      // Show results immediately
      const accuracy = piiCaughtCount > 0 ? 
        Math.round(((piiCaughtCount / (piiCaughtCount + mistakesCount)) * 100)) : 0;
      
      const resultsDiv = document.getElementById('fishingResults');
      const resultsContent = document.getElementById('resultsContent');
      
      let resultHTML = `
        <div style="text-align:center;">
          <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:20px; margin-bottom:20px;">
            <div style="background:#e3f2fd; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#1976d2;">${fishingScore}</div>
              <div style="color:#666;">Final Score</div>
            </div>
            <div style="background:#e8f5e9; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#4caf50;">${piiCaughtCount}</div>
              <div style="color:#666;">PII Removed</div>
            </div>
            <div style="background:#fff3e0; padding:15px; border-radius:8px;">
              <div style="font-size:32px; font-weight:bold; color:#ff9800;">${accuracy}%</div>
              <div style="color:#666;">Accuracy</div>
            </div>
          </div>
      `;
      
      if (accuracy >= 80) {
        resultHTML += `
          <div style="background:#e8f5e9; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#2e7d32; margin:0 0 10px 0;">🎉 Excellent PII Detection!</h4>
            <p style="margin:0; color:#555;">You successfully identified and removed ${piiCaughtCount} pieces of PII from the data ocean. Great job protecting privacy!</p>
            <button class="btn btn-secondary" onclick="resetFishingGame()" style="margin-top:15px;">🎮 Play Again</button>
          </div>
        `;
        gameState.privacyBasicsComplete = true;
        document.getElementById('privacyBasicsContinue').style.display = 'inline-block';
      } else if (accuracy >= 60) {
        resultHTML += `
          <div style="background:#fff3e0; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#e65100; margin:0 0 10px 0;">⚠️ Good Effort!</h4>
            <p style="margin:0; color:#555;">You caught ${piiCaughtCount} PII items but made ${mistakesCount} mistakes. Remember: PII includes emails, SSNs, phone numbers, and credit cards.</p>
            <button class="btn btn-secondary" onclick="resetFishingGame()" style="margin-top:15px;">🎮 Play Again</button>
          </div>
        `;
        gameState.privacyBasicsComplete = true;
        document.getElementById('privacyBasicsContinue').style.display = 'inline-block';
      } else {
        resultHTML += `
          <div style="background:#ffebee; padding:20px; border-radius:8px; margin-top:20px;">
            <h4 style="color:#c62828; margin:0 0 10px 0;">❌ Keep Practicing!</h4>
            <p style="margin:0 0 10px 0; color:#555;">You need more practice identifying PII. Remember:</p>
            <ul style="margin:5px 0 0 20px; color:#666; text-align:left;">
              <li>PII = Personal data that identifies someone</li>
              <li>Not PII = Company names, products, generic terms</li>
            </ul>
            <button class="btn" onclick="resetFishingGame()" style="margin-top:15px;">Try Again 🎣</button>
          </div>
        `;
      }
      
      resultHTML += '</div>';
      resultsContent.innerHTML = resultHTML;
      resultsDiv.style.display = 'block';
    }
    
    // Legacy function kept for compatibility
    function privacyBasicsDecision(choice) {
      const privacyKey = `privacy_basics_decision`;
      
      const feedbackDiv = document.getElementById('privacyBasicsFeedback');
      const buttons = document.querySelectorAll('#slide3 .decision-btn');
      
      // Save the choice
      gameState.choices[privacyKey] = choice;
      saveChoice(privacyKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Clear all button styling and indicators first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
        btn.style.transform = '';
        btn.style.boxShadow = '';
        btn.style.position = '';
        btn.style.zIndex = '';
        // Remove any existing indicators
        const existingIndicator = btn.querySelector('.action-indicator');
        if (existingIndicator) existingIndicator.remove();
        const existingLabel = btn.querySelector('.action-label');
        if (existingLabel) existingLabel.remove();
      });
      
      // Find the clicked button
      let clickedButton;
      buttons.forEach(btn => {
        if ((choice === 'good' && btn.textContent.includes('Great idea')) ||
            (choice === 'overcollect' && btn.textContent.includes('Excessive data')) ||
            (choice === 'security' && btn.textContent.includes('Just a security')) ||
            (choice === 'marketing' && btn.textContent.includes('Marketing needs'))) {
          clickedButton = btn;
        }
      });
      
      // Make non-selected buttons slightly faded but still readable
      buttons.forEach(btn => {
        if (btn !== clickedButton) {
          btn.style.opacity = '0.7';
          btn.style.transform = 'scale(0.98)';
        }
      });
      
      switch(choice) {
        case 'good':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Wrong! This is NOT a good idea. Collecting unnecessary sensitive data violates privacy principles and increases risk!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'overcollect':
          feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ CORRECT! This is excessive data collection that violates privacy principles!<br><br>
            <strong>Why this is a privacy risk:</strong><br>
            • SSN should NEVER be collected for simple sign-ups<br>
            • Security questions expose personal information<br>
            • Unnecessary data increases breach impact<br>
            • Violates data minimization principle<br><br>
            <strong>Best practice:</strong><br>
            Only collect what's essential for the service. For the service: email and password are sufficient!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #2E7D32';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(76,175,80,0.4), 0 0 25px rgba(76,175,80,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '✅';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #4CAF50;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          showAchievement('🛡️', 'Privacy Champion', 'Identified excessive data collection!');
          gameState.privacyBasicsComplete = true;
          document.getElementById('privacyBasicsContinue').style.display = 'inline-flex';
          document.querySelectorAll('#slide3 .decision-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('disabled');
          });
          break;
        case 'security':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ No! This is NOT just a security feature - it's excessive data collection that violates privacy laws!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'marketing':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Wrong! Marketing does NOT justify collecting sensitive personal data like SSN!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
      }
    }
    
    function showWarning() {
      alert('🚨 NEVER install plugins from websites! This is how watering hole attacks spread malware.');
    }
    
    // URL detection game
    // Move urlsChecked to gameState for proper persistence
    function checkURL(element, url, isSuspicious) {
      if (!gameState.urlsChecked) gameState.urlsChecked = [];
      
      // Check if already clicked - if so, just show feedback
      if (gameState.urlsChecked.includes(url)) {
        // Already checked - just show the visual feedback again
        if (isSuspicious) {
          alert('✅ You already identified this suspicious URL!');
        } else {
          alert('✅ You already checked this legitimate URL.');
        }
        return;
      }
      
      gameState.urlsChecked.push(url);
      const urlKey = `url_${url}`;
      gameState.choices[urlKey] = true;
      saveChoice(urlKey, true);
      
      if (isSuspicious) {
        element.classList.add('correct');
        gameState.urlsFound++;
        
        if (gameState.urlsFound === 1) {
          showAchievement('👁️', 'Sharp Eye', 'Found your first suspicious URL!');
        }
      } else {
        element.classList.add('incorrect');
      }
      
      document.getElementById('urlScore').textContent = gameState.urlsFound + '/' + gameState.totalSuspiciousUrls;
      
      if (gameState.urlsFound === gameState.totalSuspiciousUrls) {
        showAchievement('🔍', 'URL Master', 'Found all suspicious URLs!');
        document.getElementById('urlContinue').style.display = 'inline-flex';
      }
    }
    
    // Response simulation
    
    // Drag and Drop functionality for Data Handling
    let draggedItem = null;
    let dataPlacement = {};

    function initDragAndDrop() {
      // Add event listeners to draggable items
      document.querySelectorAll('.draggable-item').forEach(item => {
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
      });

      // Add event listeners to drop zones
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dragover', handleDragOver);
        zone.addEventListener('drop', handleDrop);
        zone.addEventListener('dragleave', handleDragLeave);
        zone.addEventListener('dragenter', handleDragEnter);
      });
    }

    function handleDragStart(e) {
      draggedItem = this;
      this.style.opacity = '0.5';
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragEnd(e) {
      this.style.opacity = '1';
      
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.style.background = zone.getAttribute('data-original-bg') || zone.style.background;
        zone.style.transform = 'scale(1)';
      });
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter(e) {
      this.setAttribute('data-original-bg', this.style.background);
      this.style.transform = 'scale(1.02)';
      this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
    }

    function handleDragLeave(e) {
      this.style.transform = 'scale(1)';
      this.style.boxShadow = '';
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      e.preventDefault();
      
      if (draggedItem && draggedItem !== this) {
        const dataType = draggedItem.getAttribute('data-type');
        const storageType = this.getAttribute('data-storage');
        
        // Store the placement
        dataPlacement[dataType] = storageType;
        
        // Save the placement state
        gameState.choices['data_placement'] = dataPlacement;
        saveChoice('data_placement', dataPlacement);
        
        // Clone the dragged item
        const clone = draggedItem.cloneNode(true);
        clone.style.opacity = '1';
        clone.style.margin = '4px 0';
        clone.style.cursor = 'default';
        clone.draggable = false;
        
        // Add to dropped items area
        const droppedArea = this.querySelector('.dropped-items');
        droppedArea.appendChild(clone);
        
        // Remove original item
        draggedItem.remove();
        
        // Reset styles
        this.style.transform = 'scale(1)';
        this.style.boxShadow = '';
      }
      
      return false;
    }

    function checkDataPlacement() {
      const correctPlacements = {
        'meeting-notes': 'corporate',
        'customer-data': 'encrypted',
        'passwords': 'encrypted',
        'project-docs': 'corporate'
      };
      
      // Save the current placement state
      gameState.choices['data_placement'] = dataPlacement;
      saveChoice('data_placement', dataPlacement);
      
      let allCorrect = true;
      let feedback = '<div style="background:#f8f9fa; padding:20px; border-radius:8px;">';
      feedback += '<h4 style="color:var(--dark-purple); margin-bottom:15px;">Results:</h4>';
      
      Object.keys(correctPlacements).forEach(dataType => {
        const userPlacement = dataPlacement[dataType];
        const correctPlacement = correctPlacements[dataType];
        
        let itemName = '';
        let icon = '';
        switch(dataType) {
          case 'meeting-notes': itemName = 'Meeting Notes'; icon = '📝'; break;
          case 'customer-data': itemName = 'Customer Database'; icon = '👥'; break;
          case 'passwords': itemName = 'API Keys & Passwords'; icon = '🔑'; break;
          case 'project-docs': itemName = 'Project Roadmap'; icon = '📊'; break;
        }
        
        if (userPlacement === correctPlacement) {
          feedback += `<div style="color:#2e7d32; margin:8px 0;">✅ ${icon} ${itemName} - Correct!</div>`;
        } else if (userPlacement) {
          allCorrect = false;
          let reason = '';
          if (dataType === 'customer-data' && userPlacement !== 'encrypted') {
            reason = 'Customer PII requires encrypted storage!';
          } else if (dataType === 'passwords' && userPlacement !== 'encrypted') {
            reason = 'Credentials must be in encrypted storage!';
          } else if (userPlacement === 'notes') {
            reason = 'Local notes have no backup or security!';
          } else if (userPlacement === 'personal-cloud') {
            reason = 'Personal accounts violate corporate policy!';
          }
          feedback += `<div style="color:#c62828; margin:8px 0;">❌ ${icon} ${itemName} - ${reason}</div>`;
        } else {
          allCorrect = false;
          feedback += `<div style="color:#ff9800; margin:8px 0;">⚠️ ${icon} ${itemName} - Not placed yet</div>`;
        }
      });
      
      feedback += '</div>';
      
      const feedbackDiv = document.getElementById('dataHandlingFeedback');
      if (allCorrect && Object.keys(dataPlacement).length === 4) {
        feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
          ✅ Perfect! You correctly matched all data types to appropriate storage!<br><br>
          ${feedback}
          <strong>Key Principles:</strong><br>
          • Sensitive data (PII, credentials) → Encrypted storage<br>
          • Internal docs → Corporate approved tools<br>
          • Never use personal accounts or local-only storage
        </div>`;
        
        showAchievement('🗂️', 'Data Handler Pro', 'Mastered secure data storage!');
        gameState.dataHandlingComplete = true;
        gameState.choices['data_placement_complete'] = true;
        saveChoice('data_placement_complete', true);
        document.getElementById('dataHandlingContinue').style.display = 'inline-flex';
        document.getElementById('checkPlacementBtn').disabled = true;
      } else {
        feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
          ❌ Not quite right. Review the feedback and try again!<br><br>
          ${feedback}
        </div>`;
      }
    }

    function restoreDataPlacement(savedPlacement, isComplete) {
      // Restore the saved placement state
      dataPlacement = savedPlacement || {};
      
      // Clear existing items
      document.querySelectorAll('.dropped-items').forEach(area => {
        area.innerHTML = '';
      });
      const dataItemsContainer = document.getElementById('dataItems');
      dataItemsContainer.innerHTML = '';
      
      // Items that haven't been placed
      const allItems = {
        'meeting-notes': { icon: '📝', title: 'Meeting Notes', desc: 'Team standup summary, no PII' },
        'customer-data': { icon: '👥', title: 'Customer Database', desc: '10K records with PII & financials' },
        'passwords': { icon: '🔑', title: 'API Keys & Passwords', desc: 'Production credentials' },
        'project-docs': { icon: '📊', title: 'Project Roadmap', desc: 'Internal team planning docs' }
      };
      
      // Place items that were previously dropped
      Object.entries(dataPlacement).forEach(([dataType, storageType]) => {
        const item = allItems[dataType];
        if (item) {
          const dropZone = document.querySelector(`.drop-zone[data-storage="${storageType}"]`);
          if (dropZone) {
            const droppedArea = dropZone.querySelector('.dropped-items');
            const itemEl = document.createElement('div');
            itemEl.className = 'draggable-item';
            itemEl.setAttribute('data-type', dataType);
            itemEl.style = 'background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:4px 0; border-radius:8px; cursor:default; box-shadow:0 2px 4px rgba(0,0,0,0.1); opacity:1;';
            itemEl.draggable = false;
            itemEl.innerHTML = `
              <span style="font-size:1.2rem; margin-right:8px;">${item.icon}</span>
              <strong>${item.title}</strong>
              <div style="font-size:0.85rem; color:#666; margin-top:4px;">${item.desc}</div>
            `;
            droppedArea.appendChild(itemEl);
          }
          delete allItems[dataType];
        }
      });
      
      // Add remaining items to the source area
      Object.entries(allItems).forEach(([dataType, item]) => {
        const itemEl = document.createElement('div');
        itemEl.className = 'draggable-item';
        itemEl.draggable = true;
        itemEl.setAttribute('data-type', dataType);
        itemEl.style = 'background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;';
        itemEl.innerHTML = `
          <span style="font-size:1.2rem; margin-right:8px;">${item.icon}</span>
          <strong>${item.title}</strong>
          <div style="font-size:0.85rem; color:#666; margin-top:4px;">${item.desc}</div>
        `;
        dataItemsContainer.appendChild(itemEl);
      });
      
      // Re-initialize drag and drop
      initDragAndDrop();
    }
    
    function resetDataPlacement() {
      dataPlacement = {};
      
      // Clear saved state
      delete gameState.choices['data_placement'];
      delete gameState.choices['data_placement_complete'];
      gameState.dataHandlingComplete = false;
      
      // Clear all dropped items
      document.querySelectorAll('.dropped-items').forEach(area => {
        area.innerHTML = '';
      });
      
      // Restore original items
      const dataItemsContainer = document.getElementById('dataItems');
      dataItemsContainer.innerHTML = `
        <div class="draggable-item" draggable="true" data-type="meeting-notes" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
          <span style="font-size:1.2rem; margin-right:8px;">📝</span>
          <strong>Meeting Notes</strong>
          <div style="font-size:0.85rem; color:#666; margin-top:4px;">Team standup summary, no PII</div>
        </div>
        <div class="draggable-item" draggable="true" data-type="customer-data" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
          <span style="font-size:1.2rem; margin-right:8px;">👥</span>
          <strong>Customer Database</strong>
          <div style="font-size:0.85rem; color:#666; margin-top:4px;">10K records with PII & financials</div>
        </div>
        <div class="draggable-item" draggable="true" data-type="passwords" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
          <span style="font-size:1.2rem; margin-right:8px;">🔑</span>
          <strong>API Keys & Passwords</strong>
          <div style="font-size:0.85rem; color:#666; margin-top:4px;">Production credentials</div>
        </div>
        <div class="draggable-item" draggable="true" data-type="project-docs" style="background:linear-gradient(135deg, #fff 0%, #f0f0f0 100%); padding:12px 16px; margin:8px 0; border-radius:8px; cursor:move; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.3s;">
          <span style="font-size:1.2rem; margin-right:8px;">📊</span>
          <strong>Project Roadmap</strong>
          <div style="font-size:0.85rem; color:#666; margin-top:4px;">Internal team planning docs</div>
        </div>
      `;
      
      // Re-initialize drag and drop
      initDragAndDrop();
      
      // Clear feedback
      document.getElementById('dataHandlingFeedback').innerHTML = '';
      
      // Re-enable check button
      document.getElementById('checkPlacementBtn').disabled = false;
    }

    // Old function kept for compatibility but updated
    function dataHandlingDecision(choice) {
      const dataKey = `data_handling_decision`;
      
      const feedbackDiv = document.getElementById('dataHandlingFeedback');
      const buttons = document.querySelectorAll('#slide5 .decision-btn');
      
      // Save the choice
      gameState.choices[dataKey] = choice;
      saveChoice(dataKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Clear all button styling and indicators first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
        btn.style.transform = '';
        btn.style.boxShadow = '';
        btn.style.position = '';
        btn.style.zIndex = '';
        // Remove any existing indicators
        const existingIndicator = btn.querySelector('.action-indicator');
        if (existingIndicator) existingIndicator.remove();
        const existingLabel = btn.querySelector('.action-label');
        if (existingLabel) existingLabel.remove();
      });
      
      // Find the clicked button
      let clickedButton;
      buttons.forEach(btn => {
        if ((choice === 'email' && btn.textContent.includes('Email to distribution')) ||
            (choice === 'gdrive' && btn.textContent.includes('Personal Google')) ||
            (choice === 'sharepoint' && btn.textContent.includes('Corporate SharePoint')) ||
            (choice === 'text' && btn.textContent.includes('Text screenshots'))) {
          clickedButton = btn;
        }
      });
      
      // Make non-selected buttons slightly faded but still readable
      buttons.forEach(btn => {
        if (btn !== clickedButton) {
          btn.style.opacity = '0.7';
          btn.style.transform = 'scale(0.98)';
        }
      });
      
      switch(choice) {
        case 'email':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Email is risky! Unencrypted, creates multiple copies, and can be forwarded without control.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'sharepoint':
          feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ CORRECT! Corporate SharePoint with restricted permissions is the proper way!<br><br>
            <strong>Why this is right:</strong><br>
            • Approved corporate storage<br>
            • Access controls and audit logs<br>
            • Encrypted in transit and at rest<br>
            • Can revoke access anytime<br><br>
            <strong>Remember:</strong> Always use approved tools for sensitive data.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #2E7D32';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(76,175,80,0.4), 0 0 25px rgba(76,175,80,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '✅';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #4CAF50;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          showAchievement('🗂️', 'Data Handler Pro', 'Chose secure data sharing method!');
          gameState.dataHandlingComplete = true;
          document.getElementById('dataHandlingContinue').style.display = 'inline-flex';
          document.querySelectorAll('#slide5 .decision-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('disabled');
          });
          break;
        case 'gdrive':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ NEVER use personal accounts! Violates policy, no corporate control, and public links are dangerous!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'text':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Terrible idea! Screenshots on phones have no security, can be shared anywhere, and violate policy!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
      }
    }
    
    // Function to restore GDPR feedback for a specific request
    function restoreGDPRFeedback(requestNum, choice) {
      // Store the current request temporarily
      const originalRequest = window.currentRequestScenario;
      window.currentRequestScenario = requestNum;
      
      // Get the feedback HTML based on request and choice
      let feedbackHTML = '';
      let isCorrect = false;
      
      if (requestNum === 1) {
        // Request 1: Invalid - Too broad, no account
        if (choice === 'invalid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This is NOT a valid request.</h3>
              <p><strong>Why you're right:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>No verifiable identity:</strong> They can't prove who they are or that we have their data</li>
                <li><strong>No account exists:</strong> We have no records matching this email</li>
                <li><strong>Overly broad scope:</strong> Can't delete from "all partners worldwide" - we only control our own data</li>
                <li><strong>Vague claims:</strong> "I know you have my data somewhere" isn't specific enough</li>
              </ul>
              <p style="margin-top:10px;"><strong>Proper response:</strong> Request specific information about what data they believe we have and how we obtained it.</p>
            </div>
          `;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Incorrect! This is NOT a valid request.</h3>
              <p><strong>Why this fails GDPR/CCPA requirements:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>No proof of identity or account ownership</li>
                <li>Cannot verify we actually have their data</li>
                <li>We can't action requests for third-party data</li>
                <li>GDPR/CCPA require reasonable identity verification</li>
              </ul>
              <p style="margin-top:10px;"><strong>Risk:</strong> Processing invalid requests could delete wrong person's data or waste resources on fishing attempts.</p>
            </div>
          `;
        }
      } else if (requestNum === 2) {
        // Request 2: Valid - Proper CCPA request
        if (choice === 'valid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This IS a valid CCPA request.</h3>
              <p><strong>Why this must be honored:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>California resident:</strong> CCPA applies to this user</li>
                <li><strong>Verified account:</strong> Active the service Pro account identified</li>
                <li><strong>Proper format:</strong> Correctly cites CCPA and requests specific information</li>
                <li><strong>12-month period:</strong> CCPA requires disclosure for past 12 months</li>
                <li><strong>Complete request:</strong> Asks for data, sources, purposes, and third parties</li>
              </ul>
              <p style="margin-top:10px;"><strong>Response required:</strong> Must provide all requested information within 45 days (extendable to 90 days with notice).</p>
            </div>
          `;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Wrong! This IS a valid request we must honor.</h3>
              <p><strong>Why we MUST comply:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>California resident with verified account</li>
                <li>CCPA gives them right to know what data we collect</li>
                <li>Properly formatted request with all required elements</li>
                <li>45-day response deadline is mandatory</li>
              </ul>
              <p style="margin-top:10px;"><strong>Penalty for non-compliance:</strong> $2,500-$7,500 per violation under CCPA.</p>
            </div>
          `;
        }
      } else if (requestNum === 3) {
        // Request 3: Invalid - Misuse of data portability
        if (choice === 'invalid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This is NOT a valid request.</h3>
              <p><strong>Why you caught the deception:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>Misrepresenting Article 20:</strong> Data portability covers ONLY their personal data, not others'</li>
                <li><strong>Competitor domain:</strong> Request from rival company suggests bad faith</li>
                <li><strong>Entire database:</strong> They're asking for all customers' data, not just theirs</li>
                <li><strong>Research purposes:</strong> Not a valid basis for accessing others' data</li>
                <li><strong>Security risk:</strong> This could be industrial espionage attempt</li>
              </ul>
              <p style="margin-top:10px;"><strong>Proper response:</strong> Clarify that data portability only covers their own personal data, which we can provide.</p>
            </div>
          `;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Dangerous mistake! This is NOT valid.</h3>
              <p><strong>Major red flags you missed:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>They want our ENTIRE customer database!</li>
                <li>GDPR Article 20 only covers THEIR data</li>
                <li>Competitor trying to steal our customer base</li>
                <li>Would violate every other customer's privacy</li>
              </ul>
              <p style="margin-top:10px;"><strong>Consequence:</strong> Sharing customer database would cause massive GDPR breach, potentially millions in fines!</p>
            </div>
          `;
        }
      }
      
      // Store the feedback for this request
      if (!window.gdprFeedbackStorage) {
        window.gdprFeedbackStorage = {};
      }
      window.gdprFeedbackStorage[`request_${requestNum}`] = feedbackHTML;
      
      // If this is the current tab, show the feedback
      if (window.currentRequestScenario === requestNum) {
        const feedbackDiv = document.getElementById('gdprFeedback');
        if (feedbackDiv) {
          feedbackDiv.innerHTML = feedbackHTML;
        }
      }
      
      // Also disable the buttons for this request
      if (document.getElementById(`requestContent${requestNum}`).style.display !== 'none') {
        const buttons = document.querySelectorAll('#slide7 .decision-btn');
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.style.cursor = 'not-allowed';
          if (btn.getAttribute('data-choice') === choice) {
            btn.style.opacity = '1';
            btn.style.transform = 'scale(1.02)';
            btn.style.boxShadow = '0 6px 20px rgba(0,0,0,0.2)';
          } else {
            btn.style.opacity = '0.5';
          }
        });
      }
      
      // Restore the original request number
      if (originalRequest !== undefined) {
        window.currentRequestScenario = originalRequest;
      }
    }
    
    // GDPR Decision Handler
    function gdprDecision(choice) {
      const currentRequest = window.currentRequestScenario || 1;
      const gdprKey = `gdpr_request_${currentRequest}`;
      const feedbackDiv = document.getElementById('gdprFeedback');
      const buttons = document.querySelectorAll('#slide7 .decision-btn');
      
      // Save the choice
      gameState.choices[gdprKey] = choice;
      saveChoice(gdprKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Store original styles if not already stored
      buttons.forEach(btn => {
        if (!btn.getAttribute('data-original-style')) {
          btn.setAttribute('data-original-style', btn.getAttribute('style') || '');
        }
      });
      
      // Disable all buttons but keep their appearance
      buttons.forEach(btn => {
        const originalStyle = btn.getAttribute('data-original-style');
        btn.setAttribute('style', originalStyle);
        btn.style.opacity = '0.5';
        btn.style.cursor = 'not-allowed';
        btn.disabled = true;
      });
      
      // Highlight the clicked button
      buttons.forEach(btn => {
        if (btn.getAttribute('data-choice') === choice) {
          const originalStyle = btn.getAttribute('data-original-style');
          btn.setAttribute('style', originalStyle);
          btn.style.opacity = '1';
          btn.style.transform = 'scale(1.02)';
          btn.style.boxShadow = '0 6px 20px rgba(0,0,0,0.2)';
          btn.style.cursor = 'not-allowed';
          btn.disabled = true;
        }
      });
      
      // Different feedback based on request scenario and choice
      let feedbackHTML = '';
      let isCorrect = false;
      
      if (currentRequest === 1) {
        // Request 1: Invalid - Too broad, no account
        if (choice === 'invalid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This is NOT a valid request.</h3>
              <p><strong>Why you're right:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>No verifiable identity:</strong> They can't prove who they are or that we have their data</li>
                <li><strong>No account exists:</strong> We have no records matching this email</li>
                <li><strong>Overly broad scope:</strong> Can't delete from "all partners worldwide" - we only control our own data</li>
                <li><strong>Vague claims:</strong> "I know you have my data somewhere" isn't specific enough</li>
              </ul>
              <p style="margin-top:10px;"><strong>Proper response:</strong> Request specific information about what data they believe we have and how we obtained it.</p>
            </div>
          `;
          gameState.userScore += 10;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Incorrect! This is NOT a valid request.</h3>
              <p><strong>Why this fails GDPR/CCPA requirements:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>No proof of identity or account ownership</li>
                <li>Cannot verify we actually have their data</li>
                <li>We can't action requests for third-party data</li>
                <li>GDPR/CCPA require reasonable identity verification</li>
              </ul>
              <p style="margin-top:10px;"><strong>Risk:</strong> Processing invalid requests could delete wrong person's data or waste resources on fishing attempts.</p>
            </div>
          `;
        }
      } else if (currentRequest === 2) {
        // Request 2: Valid - Proper CCPA request
        if (choice === 'valid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This IS a valid CCPA request.</h3>
              <p><strong>Why this must be honored:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>California resident:</strong> CCPA applies to this user</li>
                <li><strong>Verified account:</strong> Active the service Pro account identified</li>
                <li><strong>Proper format:</strong> Correctly cites CCPA and requests specific information</li>
                <li><strong>12-month period:</strong> CCPA requires disclosure for past 12 months</li>
                <li><strong>Complete request:</strong> Asks for data, sources, purposes, and third parties</li>
              </ul>
              <p style="margin-top:10px;"><strong>Response required:</strong> Must provide all requested information within 45 days (extendable to 90 days with notice).</p>
            </div>
          `;
          gameState.userScore += 10;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Wrong! This IS a valid request we must honor.</h3>
              <p><strong>Why we MUST comply:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>California resident with verified account</li>
                <li>CCPA gives them right to know what data we collect</li>
                <li>Properly formatted request with all required elements</li>
                <li>45-day response deadline is mandatory</li>
              </ul>
              <p style="margin-top:10px;"><strong>Penalty for non-compliance:</strong> $2,500-$7,500 per violation under CCPA.</p>
            </div>
          `;
        }
      } else if (currentRequest === 3) {
        // Request 3: Invalid - Misuse of data portability
        if (choice === 'invalid') {
          isCorrect = true;
          feedbackHTML = `
            <div class="alert alert-success">
              <h3>✅ Correct! This is NOT a valid request.</h3>
              <p><strong>Why you caught the deception:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li><strong>Misrepresenting Article 20:</strong> Data portability covers ONLY their personal data, not others'</li>
                <li><strong>Competitor domain:</strong> Request from rival company suggests bad faith</li>
                <li><strong>Entire database:</strong> They're asking for all customers' data, not just theirs</li>
                <li><strong>Research purposes:</strong> Not a valid basis for accessing others' data</li>
                <li><strong>Security risk:</strong> This could be industrial espionage attempt</li>
              </ul>
              <p style="margin-top:10px;"><strong>Proper response:</strong> Clarify that data portability only covers their own personal data, which we can provide.</p>
            </div>
          `;
          gameState.userScore += 10;
        } else {
          feedbackHTML = `
            <div class="alert alert-error">
              <h3>❌ Dangerous mistake! This is NOT valid.</h3>
              <p><strong>Major red flags you missed:</strong></p>
              <ul style="margin:10px 0 0 20px;">
                <li>They want our ENTIRE customer database!</li>
                <li>GDPR Article 20 only covers THEIR data</li>
                <li>Competitor trying to steal our customer base</li>
                <li>Would violate every other customer's privacy</li>
              </ul>
              <p style="margin-top:10px;"><strong>Consequence:</strong> Sharing customer database would cause massive GDPR breach, potentially millions in fines!</p>
            </div>
          `;
        }
      }
      
      feedbackDiv.innerHTML = feedbackHTML;
      feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      // Store the feedback for this request so it persists when switching tabs
      if (!window.gdprFeedbackStorage) {
        window.gdprFeedbackStorage = {};
      }
      window.gdprFeedbackStorage[`request_${currentRequest}`] = feedbackHTML;
      
      // Show Complete Training button immediately after answering ANY tab
      document.getElementById('gdprContinue').style.display = 'inline-block';
      
      // Mark as complete once all 3 tabs are answered
      if (gameState.choices.gdpr_request_1 && gameState.choices.gdpr_request_2 && gameState.choices.gdpr_request_3) {
        gameState.gdprComplete = true;
        if (isCorrect) {
          showAchievement('⚖️', 'Privacy Law Expert', 'Completed all GDPR/CCPA request validations!');
        }
      } else {
        // Show optional hint to try other tabs
        setTimeout(() => {
          // Find which tabs haven't been answered yet
          let unansweredTabs = [];
          for (let i = 1; i <= 3; i++) {
            if (!gameState.choices[`gdpr_request_${i}`]) {
              unansweredTabs.push(i);
            }
          }
          
          if (unansweredTabs.length > 0) {
            feedbackDiv.innerHTML += `
              <div style="margin-top:15px; padding:15px; background:#e3f2fd; border-radius:8px; border-left:4px solid #1976d2;">
                <p style="margin:0; color:#0d47a1;">
                  📋 <strong>Optional:</strong> You can complete the training now, or try Request #${unansweredTabs.join(' and #')} for extra practice!
                </p>
              </div>
            `;
          }
        }, 1000);
      }
    }
    
    
    // Knowledge check scenarios
    function loadScenarios() {
      const scenarios = [
        {
          title: 'Malware Prevention',
          type: 'malware',
          description: 'A colleague receives a USB from a conference labeled "Conference Workshop Materials". What should they do?',
          options: [
            { text: 'Plug it into their work computer to check the contents', feedback: 'Never plug unknown USBs into work computers - they can auto-execute malware.', correct: false },
            { text: 'Report it to security@yourcompany.com for proper scanning', feedback: 'Correct! Security team has isolated systems to safely check unknown devices.', correct: true },
            { text: 'Use a personal laptop to check it first', feedback: 'Personal devices can still spread malware to corporate networks.', correct: false }
          ]
        },
        {
          title: 'Device Security',
          type: 'device',
          description: 'You\'re in a conference room for a 5-minute break. Your laptop shows confidential company architecture. What do you do?',
          options: [
            { text: 'Ask a colleague to watch it while you\'re gone', feedback: 'Even trusted colleagues shouldn\'t have unsupervised access.', correct: false },
            { text: 'Leave it open since it\'s just 5 minutes', feedback: 'Never leave devices unlocked - attacks happen in seconds.', correct: false },
            { text: 'Lock the screen using Win+L or Cmd+Ctrl+Q', feedback: 'Perfect! Always lock screens when stepping away, even briefly.', correct: true }
          ]
        },
        {
          title: 'Password Security',
          type: 'password',
          description: 'Your team needs to share access to a the service organization account. Best approach?',
          options: [
            { text: 'Share the password via encrypted email', feedback: 'Never share passwords via email, even encrypted.', correct: false },
            { text: 'Use organization\'s SSO and grant individual access permissions', feedback: 'Excellent! SSO provides individual accountability and security.', correct: true },
            { text: 'Store the password in a shared document', feedback: 'Shared documents are not secure for password storage.', correct: false }
          ]
        },
        {
          title: 'Software Compliance',
          type: 'software',
          description: 'A developer wants to use a new code analysis tool they found online. What\'s the correct process?',
          options: [
            { text: 'Install it immediately if it\'s open source', feedback: 'Open source doesn\'t mean safe - needs security review.', correct: false },
            { text: 'Test it on a personal device first', feedback: 'Personal testing doesn\'t validate security for corporate use.', correct: false },
            { text: 'Submit it for security review before installation', feedback: 'Correct! All software needs security review before use.', correct: true }
          ]
        }
      ];
      
      const container = document.getElementById('scenarioContainer');
      
      // Clear existing scenarios to prevent duplicates
      container.innerHTML = '';
      
      scenarios.forEach((scenario, index) => {
        const scenarioDiv = document.createElement('div');
        scenarioDiv.style.cssText = 'background:#f8f9fa;padding:24px;border-radius:12px;margin-bottom:24px;border:2px solid #dee2e6;';
        
        const icon = scenario.type === 'plugin' ? '🔌' : scenario.type === 'redirect' ? '🔄' : '🚨';
        
        scenarioDiv.innerHTML = `
          <h3 style="color:var(--dark-purple);margin-bottom:16px;">${icon} Scenario ${index + 1}: ${scenario.title}</h3>
          <p style="margin-bottom:20px;font-style:italic;">${scenario.description}</p>
          <div id="scenario${index}Options" style="display:grid;gap:12px;">
            ${scenario.options.map((opt, i) => 
              `<button class="btn btn-secondary" style="text-align:left;padding:16px;" onclick="scenarioResponse(${index}, ${i})">${opt.text}</button>`
            ).join('')}
          </div>
          <div id="scenario${index}Feedback" style="margin-top:16px;"></div>
        `;
        
        container.appendChild(scenarioDiv);
      });
    }
    
    function scenarioResponse(scenarioIndex, optionIndex) {
      const choiceKey = `scenario_${scenarioIndex}`;
      
      // Save the choice
      gameState.choices[choiceKey] = optionIndex;
      saveChoice(choiceKey, optionIndex);
      const scenarios = [
        {
          options: [
            { feedback: 'Correct — malicious prompts on trusted sites are a hallmark of watering hole attacks.', correct: true },
            { feedback: 'Hangs can happen for many benign reasons. Not sufficient by itself.', correct: false },
            { feedback: 'Maintenance happens; not evidence of compromise on its own.', correct: false }
          ]
        },
        {
          options: [
            { feedback: 'Appearance can be spoofed; don\'t trust looks alone.', correct: false },
            { feedback: 'Correct — verify the URL and use trusted bookmarks to avoid look‑alike domains.', correct: true },
            { feedback: 'Never enter credentials on a suspicious page.', correct: false }
          ]
        },
        {
          options: [
            { feedback: 'Correct — report to Security and isolate impacted systems.', correct: true },
            { feedback: 'Public posts can tip attackers or cause confusion; use internal channels.', correct: false },
            { feedback: 'Never install unverified updates suggested by websites.', correct: false }
          ]
        }
      ];
      
      const scenario = scenarios[scenarioIndex];
      const option = scenario.options[optionIndex];
      const feedbackDiv = document.getElementById(`scenario${scenarioIndex}Feedback`);
      const buttons = document.querySelectorAll(`#scenario${scenarioIndex}Options button`);
      
      // Clear previous styling from all buttons first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
      });
      
      // Highlight the selected button
      buttons[optionIndex].style.background = option.correct ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 'linear-gradient(135deg, #ff9800, #f57c00)';
      buttons[optionIndex].style.color = 'white';
      buttons[optionIndex].style.fontWeight = '600';
      buttons[optionIndex].style.border = option.correct ? '2px solid #4CAF50' : '2px solid #ff9800';
      
      if (option.correct) {
        feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
          ✅ ${option.feedback}
        </div>`;
        
        // Disable all buttons for this scenario ONLY after correct answer
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.classList.add('disabled');
        });
        
        if (!gameState.scenariosCompleted) gameState.scenariosCompleted = 0;
        gameState.scenariosCompleted++;
        
        if (gameState.scenariosCompleted === gameState.totalScenarios) {
          document.getElementById('completeBtn').style.display = 'inline-flex';
          if (!gameState.achievements.includes('scenario_master')) {
            gameState.achievements.push('scenario_master');
            showAchievement('🎯', 'Scenario Master', 'Completed all knowledge checks!');
          }
        }
      } else {
        feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
          ❌ ${option.feedback} Try again!
        </div>`;
        // Mark the incorrect button with orange but keep enabled
        buttons[optionIndex].style.opacity = '0.7';
      }
    }
    
    // Navigation
    function updateProgress() {
      document.getElementById('progressBar').style.width = (gameState.currentSlide / gameState.totalSlides) * 100 + '%';
    }
    
    function showSlide(n) {
      document.querySelectorAll('.slide').forEach(slide => slide.classList.remove('active'));
      document.getElementById('slide' + n).classList.add('active');
      gameState.currentSlide = n;
      updateProgress();
      updateSCORM();
      
      // Initialize drag and drop for slide 5
      if (n === 5) {
        setTimeout(() => {
          initDragAndDrop();
        }, 100);
      }
      
      // Notify parent frame if embedded
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'slideChange',
          slide: n,
          module: 'privacy'
        }, '*');
      }
      
      // Restore choices when reaching decision slides
      if ([3, 5, 7].includes(n)) {
        if (gameState.choices && Object.keys(gameState.choices).length > 0) {
          setTimeout(restoreChoices, 50);
        }
      }
    }
    
    function nextSlide() {
      if (gameState.currentSlide < gameState.totalSlides) {
        showSlide(gameState.currentSlide + 1);
      }
    }
    
    function previousSlide() {
      if (gameState.currentSlide > 1) {
        showSlide(gameState.currentSlide - 1);
      }
    }
    
    function startTraining() {
      showAchievement('🚀', 'Training Started!', 'Your cybersecurity journey begins!');
      nextSlide();
    }
    
    // Completion
    function completeTraining() {
      
      // Calculate completion score based on simulations only
      let totalActivities = 3; // 3 simulations (Privacy Basics, Data Handling, GDPR)
      let completedActivities = 0;
      
      // Add simulation completions
      if (gameState.privacyBasicsComplete) completedActivities++;
      if (gameState.dataHandlingComplete) completedActivities++;
      if (gameState.gdprComplete) completedActivities++;
      
      const finalScore = Math.round((completedActivities / totalActivities) * 100);
      
      document.getElementById('finalScore').textContent = finalScore + '%';
      
      // Notify parent frame if embedded
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'moduleComplete',
          module: 'privacy'
        }, '*');
      }
      
      // Update SCORM
      scorm.setValue('cmi.core.score.raw', String(finalScore));
      scorm.setValue('cmi.core.lesson_status', finalScore >= 80 ? 'passed' : 'completed');
      scorm.commit();
      
      showSlide(8);
      launchConfetti();
      showAchievement('🏆', 'Privacy Training Complete!', 'You are now a Privacy Protection Expert!');
    }
    
    function launchConfetti() {
      const container = document.getElementById('confettiContainer');
      container.style.display = 'block';
      const colors = ['#7B2CBF', '#4CAF50', '#FFD700', '#FF6B6B', '#4ECDC4'];
      
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = (Math.random() * 10 + 5) + 'px';
          confetti.style.height = confetti.style.width;
          confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          container.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 4000);
        }, i * 30);
      }
    }
    
    // Update SCORM
    // Choice persistence functions
    function saveChoice(slideId, choice) {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({
          type: 'choiceUpdate',
          slideId: slideId,
          choice: choice,
          choicesData: {
            choices: gameState.choices,
            scenariosCompleted: gameState.scenariosCompleted || 0,
            urlsChecked: gameState.urlsChecked || []
          }
        }, '*');
      }
    }
    
    function restoreChoices() {
      const choicesData = gameState.choices || {};
      
      // Restore PII Fishing Game state (slide 3)
      if (gameState.currentSlide === 3 && choicesData['fishing_game_completed'] && choicesData['fishing_game_state']) {
        fishingGameCompleted = true;
        restoreFishingGameState(choicesData['fishing_game_state']);
      }
      
      // Restore privacy basics decision (slide 3) - this is legacy, keeping for compatibility
      if (choicesData['privacy_basics_decision'] && gameState.currentSlide === 3) {
        const choice = choicesData['privacy_basics_decision'];
        const feedbackDiv = document.getElementById('privacyBasicsFeedback');
        const buttons = document.querySelectorAll('#slide3 .decision-btn');
        
        // Find the selected button
        let selectedButton = null;
        buttons.forEach(btn => {
          if ((choice === 'good' && btn.textContent.includes('Great idea')) ||
              (choice === 'overcollect' && btn.textContent.includes('Excessive data')) ||
              (choice === 'security' && btn.textContent.includes('Just a security')) ||
              (choice === 'marketing' && btn.textContent.includes('Marketing needs'))) {
            selectedButton = btn;
          }
        });
        
        if (selectedButton && feedbackDiv) {
          // Apply visual restoration
          buttons.forEach(btn => {
            if (btn !== selectedButton) {
              btn.style.opacity = '0.7';
              btn.style.transform = 'scale(0.98)';
            }
          });
          
          const isCorrect = choice === 'overcollect';
          const color = isCorrect ? '#4CAF50' : '#f44336';
          const darkColor = isCorrect ? '#2E7D32' : '#C62828';
          const icon = isCorrect ? '✅' : '❌';
          
          selectedButton.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
          selectedButton.style.color = 'white';
          selectedButton.style.fontWeight = 'bold';
          selectedButton.style.border = `4px solid ${darkColor}`;
          selectedButton.style.transform = 'scale(1.12)';
          selectedButton.style.boxShadow = `0 8px 30px ${color}66, 0 0 25px ${color}44`;
          selectedButton.style.opacity = '1';
          selectedButton.style.position = 'relative';
          selectedButton.style.zIndex = '100';
          
          // Remove any existing indicators first
          const existingIndicator = selectedButton.querySelector('.action-indicator');
          if (existingIndicator) existingIndicator.remove();
          const existingLabel = selectedButton.querySelector('.action-label');
          if (existingLabel) existingLabel.remove();
          
          // Add icon and label
          const iconEl = document.createElement('span');
          iconEl.className = 'action-indicator';
          iconEl.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
          iconEl.textContent = icon;
          selectedButton.insertBefore(iconEl, selectedButton.firstChild);
          
          const label = document.createElement('div');
          label.className = 'action-label';
          label.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: ${color};
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          label.textContent = '🎯 YOUR CHOICE';
          selectedButton.appendChild(label);
          
          // Show feedback
          if (choice === 'overcollect') {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ CORRECT! This is excessive data collection that violates privacy principles!
            </div>`;
            gameState.privacyBasicsComplete = true;
            // Show continue button
            document.getElementById('privacyBasicsContinue').style.display = 'inline-flex';
            // Disable all buttons after correct answer
            buttons.forEach(btn => {
              btn.disabled = true;
              if (btn !== selectedButton) {
                btn.style.opacity = '0.6';
              }
            });
          } else {
            feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
              ❌ Not the best choice. Try again!
            </div>`;
          }
        }
      }
      
      // Restore data placement for drag and drop (slide 5)
      if (choicesData['data_placement'] && gameState.currentSlide === 5) {
        setTimeout(() => {
          const isComplete = choicesData['data_placement_complete'] === true;
          restoreDataPlacement(choicesData['data_placement'], isComplete);
          
          // If it was completed, show the success feedback
          if (isComplete) {
            const feedbackDiv = document.getElementById('dataHandlingFeedback');
            let feedback = '<div style="background:#f8f9fa; padding:20px; border-radius:8px;">';
            feedback += '<h4 style="color:var(--dark-purple); margin-bottom:15px;">Results:</h4>';
            feedback += '<div style="color:#2e7d32; margin:8px 0;">✅ 📝 Meeting Notes - Correct!</div>';
            feedback += '<div style="color:#2e7d32; margin:8px 0;">✅ 👥 Customer Database - Correct!</div>';
            feedback += '<div style="color:#2e7d32; margin:8px 0;">✅ 🔑 API Keys & Passwords - Correct!</div>';
            feedback += '<div style="color:#2e7d32; margin:8px 0;">✅ 📊 Project Roadmap - Correct!</div>';
            feedback += '</div>';
            
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ Perfect! You correctly matched all data types to appropriate storage!<br><br>
              ${feedback}
              <strong>Key Principles:</strong><br>
              • Sensitive data (PII, credentials) → Encrypted storage<br>
              • Internal docs → Corporate approved tools<br>
              • Never use personal accounts or local-only storage
            </div>`;
            
            gameState.dataHandlingComplete = true;
            document.getElementById('dataHandlingContinue').style.display = 'inline-flex';
            document.getElementById('checkPlacementBtn').disabled = true;
          }
        }, 100);
      }
      
      // Restore data handling decision (slide 5) - legacy compatibility
      if (choicesData['data_handling_decision'] && gameState.currentSlide === 5) {
        const choice = choicesData['data_handling_decision'];
        const feedbackDiv = document.getElementById('dataHandlingFeedback');
        const buttons = document.querySelectorAll('#slide5 .decision-btn');
        
        // Find the selected button
        let selectedButton = null;
        buttons.forEach(btn => {
          if ((choice === 'email' && btn.textContent.includes('Email to distribution')) ||
              (choice === 'gdrive' && btn.textContent.includes('Personal Google')) ||
              (choice === 'sharepoint' && btn.textContent.includes('Corporate SharePoint')) ||
              (choice === 'text' && btn.textContent.includes('Text screenshots'))) {
            selectedButton = btn;
          }
        });
        
        if (selectedButton && feedbackDiv) {
          // Apply visual restoration
          buttons.forEach(btn => {
            if (btn !== selectedButton) {
              btn.style.opacity = '0.7';
              btn.style.transform = 'scale(0.98)';
            }
          });
          
          const isCorrect = choice === 'sharepoint';
          const color = isCorrect ? '#4CAF50' : '#f44336';
          const darkColor = isCorrect ? '#2E7D32' : '#C62828';
          const icon = isCorrect ? '✅' : '❌';
          
          selectedButton.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
          selectedButton.style.color = 'white';
          selectedButton.style.fontWeight = 'bold';
          selectedButton.style.border = `4px solid ${darkColor}`;
          selectedButton.style.transform = 'scale(1.12)';
          selectedButton.style.boxShadow = `0 8px 30px ${color}66, 0 0 25px ${color}44`;
          selectedButton.style.opacity = '1';
          selectedButton.style.position = 'relative';
          selectedButton.style.zIndex = '100';
          
          // Remove any existing indicators first
          const existingIndicator = selectedButton.querySelector('.action-indicator');
          if (existingIndicator) existingIndicator.remove();
          const existingLabel = selectedButton.querySelector('.action-label');
          if (existingLabel) existingLabel.remove();
          
          // Add icon and label
          const iconEl = document.createElement('span');
          iconEl.className = 'action-indicator';
          iconEl.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
          iconEl.textContent = icon;
          selectedButton.insertBefore(iconEl, selectedButton.firstChild);
          
          const label = document.createElement('div');
          label.className = 'action-label';
          label.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: ${color};
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          label.textContent = '🎯 YOUR CHOICE';
          selectedButton.appendChild(label);
          
          // Show feedback
          if (choice === 'sharepoint') {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ CORRECT! Corporate SharePoint with restricted permissions is the proper way!
            </div>`;
            gameState.dataHandlingComplete = true;
            // Show continue button
            document.getElementById('dataHandlingContinue').style.display = 'inline-flex';
            // Disable all buttons after correct answer
            buttons.forEach(btn => {
              btn.disabled = true;
              if (btn !== selectedButton) {
                btn.style.opacity = '0.6';
              }
            });
          } else {
            feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
              ❌ Not secure enough. Try again!
            </div>`;
          }
        }
      }
      
      // Restore GDPR decision (slide 7)
      if (gameState.currentSlide === 7) {
        // Restore the current tab if saved
        const currentTab = choicesData['gdpr_current_tab'] || 1;
        
        // Restore any answered requests
        setTimeout(() => {
          // Restore feedback for each answered request
          for (let requestNum = 1; requestNum <= 3; requestNum++) {
            const choice = choicesData[`gdpr_request_${requestNum}`];
            if (choice) {
              restoreGDPRFeedback(requestNum, choice);
            }
          }
          
          // Then switch to the saved tab
          if (currentTab !== 1) {
            const tabButtons = document.querySelectorAll('.request-tab');
            if (tabButtons[currentTab - 1]) {
              tabButtons[currentTab - 1].click();
            }
          }
        }, 100);
        
        // Check if any requests have been answered
        if (choicesData['gdpr_request_1'] || choicesData['gdpr_request_2'] || choicesData['gdpr_request_3']) {
          document.getElementById('gdprContinue').style.display = 'inline-flex';
        }
        
        // Legacy compatibility
        if (choicesData['gdpr_decision'] && choicesData['gdpr_decision'] === 'both') {
          gameState.gdprComplete = true;
          const feedbackDiv = document.getElementById('gdprFeedback');
          if (feedbackDiv) {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ You've already completed the GDPR/CCPA exercise!
            </div>`;
            document.getElementById('gdprContinue').style.display = 'inline-flex';
          }
        }
      }
      
    }
    
    function updateSCORM() {
      if (scorm.api) {
        scorm.setValue('cmi.core.lesson_location', String(gameState.currentSlide));
        scorm.setValue('cmi.suspend_data', JSON.stringify({
          currentSlide: gameState.currentSlide,
          achievements: gameState.achievements
        }));
        scorm.commit();
      }
    }
    
    // Initialize
    window.onload = function() {
      
      // Check if SCORM should be disabled (when loaded in iframe)
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('scorm') !== 'disabled') {
        scorm.init();
      }
      
      // Check if we should resume from a specific slide
      const resumeSlide = urlParams.get('slide');
      if (resumeSlide && !isNaN(resumeSlide)) {
        gameState.currentSlide = parseInt(resumeSlide);
        // Show the correct slide immediately to avoid flash
        showSlide(gameState.currentSlide);
      }
      
      
      // Restore choices if provided
      const savedChoices = urlParams.get('choices');
      if (savedChoices) {
        try {
          const choicesData = JSON.parse(decodeURIComponent(savedChoices));
          if (choicesData.choices !== undefined) {
            gameState.choices = choicesData.choices;
            gameState.scenariosCompleted = choicesData.scenariosCompleted || 0;
            // Don't restore urlsChecked here - it will be rebuilt from choices
          } else {
            gameState.choices = choicesData;
          }
          // Don't restore here - will be done when reaching the specific slide
        } catch (e) {
          console.warn('Failed to parse saved choices:', e);
        }
      }
      
      updateProgress();
      updateSCORM();
      
      // If we're resuming on a slide with choices, restore them with minimal delay
      if ((gameState.currentSlide === 3 || gameState.currentSlide === 5 || gameState.currentSlide === 7) && savedChoices) {
        setTimeout(restoreChoices, 50);
      }
    };
    
    // Owl easter egg
    function owlClick() {
      const owl = document.querySelector('.grc-owl');
      owl.style.animation = 'none';
      setTimeout(() => {
        owl.style.animation = 'bounce 2s ease-in-out infinite, spin 0.5s ease';
      }, 10);
      if (!gameState.achievements.includes('owl')) {
        gameState.achievements.push('owl');
        showAchievement('👾', 'Wise Discovery!', 'You found the easter egg!');
      }
      // If in iframe, send message to parent to go home
      if (window.parent !== window) {
        window.parent.postMessage({ type: 'goHome' }, '*');
      }
    }
  </script>
</body>
</html>