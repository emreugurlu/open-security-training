<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GRC Engineering: General Cybersecurity Awareness</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    :root {
      --primary-purple:#7B2CBF; --light-purple:#E0B0FF; --dark-purple:#4A1A6B;
      --primary-teal:#06A77D; --light-teal:#B2F5E8; --dark-teal:#045F4A;
      --primary-off-black:#17191E; --primary-white:#FFFFFF; --success-green:#4CAF50;
      --warning-amber:#FF9800; --error-red:#F44336; --neutral-gray:#9E9E9E;
      --light-gray:#F5F5F5; --medium-gray:#E0E0E0; --primary-gradient: linear-gradient(135deg, #7B2CBF 0%, #06A77D 100%);
    }
    
    body { 
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background: #0a0e27;
      color:var(--primary-off-black); 
      min-height:100vh; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      padding:20px; 
      line-height:1.6;
      overflow-x: hidden;
    }
    
    /* Static gradient background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 50%, rgba(123,44,191,0.15) 0%, transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(123,44,191,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 20%, rgba(0,85,204,0.1) 0%, transparent 50%);
      z-index: -1;
    }
    
    .module-container { 
      background:var(--primary-white); 
      border-radius:16px; 
      box-shadow:0 10px 40px rgba(0,8,77,.25); 
      max-width:1100px; 
      width:100%; 
      overflow:hidden;
    }
    
    .grc-header { 
      background:var(--primary-gradient); 
      padding:20px 32px; 
      display:flex; 
      align-items:center; 
      justify-content:space-between; 
      color:var(--primary-white);
      position: relative;
      overflow: hidden;
    }
    
    .grc-logo { 
      display:flex; 
      align-items:center; 
      gap:16px; 
      font-weight:700; 
      font-size:20px;
      z-index: 2;
    }
    
    .grc-owl { 
      width:48px; 
      height:48px; 
      background:var(--primary-white); 
      border-radius:12px; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-size:28px;
      animation: bounce 2s ease-in-out infinite;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .grc-owl:hover {
      transform: rotate(10deg) scale(1.1);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    
    .progress-bar { 
      height:6px; 
      background:var(--medium-gray); 
      position:relative; 
      overflow:hidden; 
    }
    
    .progress-fill { 
      height:100%; 
      background:var(--primary-gradient); 
      width:0%; 
      transition:width .5s ease;
      box-shadow: 0 0 10px rgba(123,44,191,0.5);
    }
    
    .slide { 
      padding:56px 48px; 
      min-height:580px; 
      display:none; 
      animation:slideIn .4s ease;
      position: relative;
    }
    
    .slide.active { display:block; }
    
    @keyframes slideIn { 
      from{ opacity:0; transform:translateX(30px); } 
      to{ opacity:1; transform:translateX(0); } 
    }
    
    /* Hide slide content briefly during restoration */
    .slide.restoring {
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    h1 { 
      color:var(--dark-purple); 
      font-size:2.5rem; 
      font-weight:800; 
      margin-bottom:24px; 
      text-align:center; 
      line-height:1.2; 
    }
    
    h2 { 
      color:var(--dark-purple); 
      font-size:2rem; 
      font-weight:700; 
      margin-bottom:24px; 
    }
    
    p { 
      font-size:1.125rem; 
      margin-bottom:20px; 
      color:var(--primary-off-black); 
      line-height:1.7;
    }
    
    .intro-animation {
      font-size: 120px;
      text-align: center;
      margin: 40px 0;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .info-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin: 32px 0;
    }
    
    .info-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 2px solid var(--medium-gray);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .info-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      border-color: var(--primary-purple);
    }
    
    .info-card-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }
    
    .info-card h3 {
      color: var(--dark-purple);
      font-size: 1.25rem;
      margin-bottom: 12px;
    }
    
    .navigation { 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      margin-top:40px; 
      padding-top:32px; 
      border-top:2px solid var(--medium-gray); 
    }
    
    .btn { 
      background:var(--primary-gradient); 
      color:var(--primary-white); 
      padding:14px 28px; 
      border:none; 
      border-radius:8px; 
      font-size:1rem; 
      font-weight:600; 
      cursor:pointer; 
      transition:all .3s ease; 
      margin:8px; 
      display:inline-flex; 
      align-items:center; 
      gap:8px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn:hover { 
      transform:translateY(-2px); 
      box-shadow:0 6px 20px rgba(123,44,191,.3); 
    }
    
    .btn-secondary { 
      background:transparent; 
      color:var(--primary-purple); 
      border:2px solid var(--primary-purple); 
    }
    
    .btn-secondary:hover { 
      background:var(--light-purple); 
      border-color:var(--dark-purple); 
      color:var(--dark-purple); 
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ff3b30, #ff6b60);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4CAF50, #66BB6A);
    }
    
    .btn:disabled, .btn.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Watering hole simulator */
    .website-simulator {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 0;
      margin: 24px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    .browser-bar {
      background: #2d2d2d;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid #444;
    }
    
    .browser-controls {
      display: flex;
      gap: 8px;
    }
    
    .browser-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ff5f57;
    }
    
    .browser-dot:nth-child(2) { background: #ffbd2e; }
    .browser-dot:nth-child(3) { background: #28ca42; }
    
    .url-bar {
      flex: 1;
      background: #1a1a1a;
      color: #888;
      padding: 6px 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    
    .suspicious-url {
      color: #ff3b30;
      font-weight: bold;
    }
    
    .website-content {
      background: #fff;
      padding: 32px;
      min-height: 300px;
      position: relative;
    }
    
    .fake-popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      text-align: center;
      display: none;
      z-index: 10;
      border: 3px solid #ff3b30;
    }
    
    .fake-popup.show {
      display: block;
      animation: popIn 0.3s ease;
    }
    
    @keyframes popIn {
      from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    /* Interactive decision buttons */
    .decision-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
      position: relative;
      z-index: 50;
    }
    
    .decision-btn {
      background: #fff;
      border: 2px solid #e0e0e0;
      padding: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      text-align: center;
      position: relative;
    }
    
    .decision-btn:hover {
      background: var(--light-purple);
      border-color: var(--primary-purple);
      box-shadow: 0 4px 12px rgba(123,44,191,0.2);
      transform: translateY(-2px);
    }
    
    .decision-btn.selected {
      background: var(--light-purple);
      border-color: var(--primary-purple);
      font-weight: 600;
    }
    
    .decision-btn.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Detection challenge */
    .detection-challenge {
      background: #f8f9fa;
      border: 2px solid var(--medium-gray);
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
    }
    
    .site-card {
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin: 12px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .site-card:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .site-card.selected {
      border-color: var(--primary-purple);
      background: var(--light-purple);
    }
    
    .site-card.correct {
      border-color: var(--success-green);
      background: rgba(76,175,80,0.1);
    }
    
    .site-card.incorrect {
      border-color: var(--error-red);
      background: rgba(244,67,54,0.1);
    }
    
    .url-display {
      font-family: monospace;
      font-size: 14px;
      color: #666;
      margin-top: 8px;
      padding: 4px 8px;
      background: #f0f0f0;
      border-radius: 4px;
      display: inline-block;
    }
    
    /* Gamification elements */
    .achievement {
      position: fixed;
      top: 20px;
      right: -500px;
      background: #fff;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 16px;
      transition: right 0.5s ease;
      z-index: 1000;
      pointer-events: none;
    }
    
    .achievement.show {
      right: 20px;
      pointer-events: auto;
    }
    
    .achievement-icon {
      font-size: 32px;
      animation: celebrate 0.5s ease;
    }
    
    @keyframes celebrate {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
    }
    
    .score-display {
      background: linear-gradient(135deg, #7B2CBF, #06A77D);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      font-size: 1.2rem;
      box-shadow: 0 4px 12px rgba(123,44,191,0.3);
    }
    
    /* Certificate */
    .certificate {
      text-align: center;
      padding: 48px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 16px;
      border: 3px solid var(--primary-purple);
      position: relative;
      overflow: hidden;
    }
    
    .certificate::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(123,44,191,0.1), transparent);
      animation: shine 3s linear infinite;
    }
    
    @keyframes shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }
    
    .certificate-seal {
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
      position: relative;
      animation: sealRotate 20s linear infinite;
    }
    
    @keyframes sealRotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .trophy-icon {
      font-size: 80px;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      animation: trophyGlow 2s ease-in-out infinite;
    }
    
    @keyframes trophyGlow {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
      display: none;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--primary-purple);
      animation: confettiFall 3s linear;
    }
    
    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    
    /* SCORM status indicator */
    .scorm-status {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: rgba(23,25,30,.9);
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: .75rem;
      display: none;
      backdrop-filter: blur(10px);
    }
    
    /* Feedback styles */
    .feedback {
      padding: 16px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 16px;
      display: none;
    }
    
    .feedback.correct {
      background: #d4edda;
      color: #155724;
      border: 2px solid var(--success-green);
    }
    
    .feedback.incorrect {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid var(--error-red);
    }
    
    .feedback.warning {
      background: #fff3cd;
      color: #856404;
      border: 2px solid #ffc107;
    }
    
    /* Responsive */
    @media (max-width:768px) {
      .slide { padding:32px 24px; }
      h1 { font-size:2rem; }
      h2 { font-size:1.5rem; }
      .decision-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- Achievement Popup -->
  <div class="achievement" id="achievementPopup">
    <div class="achievement-icon" id="achievementIcon">🏆</div>
    <div>
      <div style="font-weight:700; color:var(--dark-purple);" id="achievementTitle">Achievement Unlocked!</div>
      <div style="font-size:14px; color:#6c757d;" id="achievementText">You're making great progress!</div>
    </div>
  </div>

  <!-- Confetti Container -->
  <div class="confetti-container" id="confettiContainer"></div>

  <div class="module-container">
    <div class="grc-header">
      <div class="grc-logo">
        <div class="grc-owl" onclick="owlClick()">👾</div>
        <span>General Cybersecurity Awareness</span>
      </div>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>

    <!-- Slide 1: Welcome -->
    <div class="slide active" id="slide1">
      <h1>🛡️ General Cybersecurity Awareness</h1>
      <div class="intro-animation">🔒</div>
      <p style="text-align:center; font-size:1.4rem; margin-bottom:24px; color:#7B2CBF; font-weight:600;">
        Protect Your Organization from Common Security Threats
      </p>
      
      <div style="background:#f0f7ff; padding:24px; border-radius:12px; margin:20px auto; max-width:700px; border:1px solid #d0e4ff;">
        <p style="font-size:1.1rem; color:#333; margin-bottom:16px; font-weight:600;">
          In this training you will learn to:
        </p>
        <ul style="text-align:left; font-size:1rem; color:#555; line-height:1.8; max-width:500px; margin:0 auto; list-style:none;">
          <li>🦠 <strong>Identify and respond</strong> to ransomware attacks</li>
          <li>💻 <strong>Secure your devices</strong> when working from home</li>
          <li>🔑 <strong>Create strong passwords</strong> that protect company data</li>
          <li>🤖 <strong>Recognize unsafe AI tools</strong> that leak confidential info</li>
        </ul>
      </div>
      
      <div class="navigation">
        <span></span>
        <button class="btn" onclick="startTraining()">Begin Training →</button>
      </div>
    </div>

    <!-- Slide 2: Understanding Watering Holes -->
    <div class="slide" id="slide2">
      <h2>📚 Understanding Malware Threats</h2>
      <p>Malware can infiltrate organizational systems through various attack vectors, causing data breaches and operational disruption.</p>
      
      <div class="info-cards">
        <div class="info-card">
          <span class="info-card-icon">💾</span>
          <h3>USB Attacks</h3>
          <p>Most organizations block USB devices by default, but never plug in unknown USBs - they have the potential to auto-execute malware</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🔐</span>
          <h3>Ransomware</h3>
          <p>Encrypts files and demands payment, spreading rapidly across networks</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🕵️</span>
          <h3>Spyware</h3>
          <p>Hidden software that monitors activity and steals sensitive organizational data</p>
        </div>
      </div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Continue →</button>
      </div>
    </div>

    <!-- Slide 3: Ransomware Detection Simulation -->
    <div class="slide" id="slide3">
      <h2>🚨 Critical: Ransomware Attack Detected!</h2>
      <p>You return from lunch to find your workstation displaying these alarming symptoms:</p>
      
      <div class="simulation-box">
        <div style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border-radius: 12px; padding: 25px; box-shadow: 0 10px 40px rgba(255,0,0,0.2);">
          <div style="background: #000; border-radius: 8px; padding: 20px; border: 2px solid #ff3b30;">
            <div style="text-align: center; margin-bottom: 20px;">
              <h3 style="color: #ff3b30; margin: 0; animation: pulse 1s infinite;">
                ⚠️ RANSOMWARE ACTIVITY IN PROGRESS ⚠️
              </h3>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
              <div style="background: rgba(255,59,48,0.1); border: 1px solid #ff3b30; border-radius: 8px; padding: 15px;">
                <h4 style="color: #ff3b30; margin: 0 0 10px 0;">🔥 System Resources</h4>
                <div style="color: #fff; font-size: 14px; line-height: 1.6;">
                  <div>CPU: <span style="color: #ff3b30; font-weight: bold;">97%</span></div>
                  <div>Memory: <span style="color: #ff9500; font-weight: bold;">89%</span></div>
                  <div>Disk I/O: <span style="color: #ff3b30; font-weight: bold;">MAXIMUM</span></div>
                </div>
              </div>
              
              <div style="background: rgba(255,59,48,0.1); border: 1px solid #ff3b30; border-radius: 8px; padding: 15px;">
                <h4 style="color: #ff3b30; margin: 0 0 10px 0;">🌐 Network Activity</h4>
                <div style="color: #fff; font-size: 14px; line-height: 1.6;">
                  <div>Upload: <span style="color: #ff3b30; font-weight: bold;">2.3 GB</span></div>
                  <div>Target: <span style="color: #ff9500; font-weight: bold;">185.243.x.x</span></div>
                  <div>Status: <span style="color: #ff3b30; animation: flicker 0.5s infinite;">ACTIVE</span></div>
                </div>
              </div>
            </div>
            
            <div style="background: rgba(255,204,0,0.1); border: 1px solid #ffcc00; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
              <h4 style="color: #ffcc00; margin: 0 0 10px 0;">🔐 Files Being Encrypted</h4>
              <div style="font-family: 'Courier New', monospace; font-size: 13px; color: #ffcc00; line-height: 1.8;">
                <div>✗ Contracts-2024.xlsx → .LOCKED</div>
                <div>✗ Customer-Database.csv → .LOCKED</div>
                <div>✗ Financial-Reports.pdf → .LOCKED</div>
                <div style="color: #ff3b30; font-weight: bold; margin-top: 10px;">
                  Total: 847 files encrypted and counting...
                </div>
              </div>
            </div>
            
            <div style="background: rgba(255,59,48,0.2); border: 2px solid #ff3b30; border-radius: 8px; padding: 15px; text-align: center;">
              <p style="color: #ff3b30; font-weight: bold; margin: 0; font-size: 16px;">
                ⏱️ CRITICAL: Data is being stolen RIGHT NOW!
              </p>
              <p style="color: #ffcc00; margin: 5px 0 0 0; font-size: 14px;">
                Every second counts - customer data at risk!
              </p>
            </div>
          </div>
        </div>
        
        <p style="text-align:center; font-weight:600; margin-top:24px; color:#ff3b30; font-size: 18px;">
          What's your IMMEDIATE action?
        </p>
      </div>
      
      <div class="decision-grid">
        <button class="decision-btn" onclick="ransomwareDecision('wait')" id="ransom-wait">Wait and document what's happening</button>
        <button class="decision-btn" onclick="ransomwareDecision('disconnect')" id="ransom-disconnect">Report to security@yourcompany.com or #security-team</button>
        <button class="decision-btn" onclick="ransomwareDecision('restart')" id="ransom-restart">Restart to stop the process</button>
        <button class="decision-btn" onclick="ransomwareDecision('antivirus')" id="ransom-antivirus">Run security scan</button>
      </div>
      
      <div id="ransomwareFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()" id="ransomwareContinue" style="display:none;">Continue →</button>
      </div>
    </div>

    <!-- Slide 4: Device Security Principles -->
    <div class="slide" id="slide4">
      <h2>🔒 Device Security Best Practices</h2>
      <p>Protecting organizational devices requires constant vigilance and proper security habits.</p>
      
      <div class="info-cards">
        <div class="info-card">
          <span class="info-card-icon">🔐</span>
          <h3>Lock Always</h3>
          <p>Lock screens even for "just a second" - attacks happen instantly</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">👁️</span>
          <h3>Visual Privacy</h3>
          <p>In public settings, use privacy screens and be aware of shoulder surfers</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">📱</span>
          <h3>Physical Security</h3>
          <p>Never leave devices unattended in public settings</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🌍</span>
          <h3>Public Spaces</h3>
          <p>Extra caution in cafes, airports, and conferences</p>
        </div>
      </div>
      
      <p style="text-align:center; color:var(--error-red); font-weight:600; margin-top:24px;">
        ⚠️ Physical access = Game over!
      </p>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Next →</button>
      </div>
    </div>

    <!-- Slide 5: Device Lock Simulation -->
    <div class="slide" id="slide5">
      <h2>💻 Device Security: Working From Home</h2>
      <p>You're working from home with friends visiting. You need to step away from your work laptop.</p>
      
      <div class="website-simulator">
        <div class="browser-bar">
          <div class="browser-controls">
            <div class="browser-dot"></div>
            <div class="browser-dot"></div>
            <div class="browser-dot"></div>
          </div>
          <div class="url-bar">Device Security Simulation</div>
        </div>
        <div class="website-content" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
          <div style="text-align:center; padding:40px;">
            <div id="lockIcon" style="font-size:80px; margin-bottom:20px;">🔓</div>
            <h3 id="deviceStatus">Laptop Unlocked</h3>
            <p style="margin:20px 0;">Confidential data visible on screen</p>
            <p style="font-weight:600;">Friends are in your living room - bathroom break needed!</p>
          </div>
        </div>
      </div>
      
      <div class="decision-grid">
        <button class="decision-btn" onclick="lockDecision('quick')" id="lock-quick">They're friends, just leave it</button>
        <button class="decision-btn" onclick="lockDecision('lock')" id="lock-lock">Lock screen (Win+L / Cmd+Ctrl+Q)</button>
        <button class="decision-btn" onclick="lockDecision('ask')" id="lock-ask">Ask friends not to look</button>
        <button class="decision-btn" onclick="lockDecision('take')" id="lock-take">Take laptop with you</button>
      </div>
      
      <div id="lockFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()" id="lockContinue" style="display:none;">Continue →</button>
      </div>
    </div>

    <!-- Slide 6: Password Security Principles -->
    <div class="slide" id="slide6">
      <h2>🔑 Password Security Best Practices</h2>
      <p>Strong passwords and proper management are your first line of defense.</p>
      
      <div class="info-cards">
        <div class="info-card">
          <span class="info-card-icon">🔢</span>
          <h3>Length Matters</h3>
          <p>Use 12+ characters - longer is exponentially stronger</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🎲</span>
          <h3>Unique Always</h3>
          <p>Never reuse passwords - one breach shouldn't compromise all</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🛡️</span>
          <h3>2FA Required</h3>
          <p>Enable on all accounts - especially email and banking</p>
        </div>
      </div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Continue →</button>
      </div>
    </div>

    <!-- Slide 7: Password Strength Education -->
    <div class="slide" id="slide7">
      <h2>🔑 Password Strength Analyzer</h2>
      <p>Click on example passwords below to see why they're weak or strong. NEVER type your real password!</p>
      
      <div class="simulation-box">
        <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
          <div style="background:#fff3cd; border:2px solid #ffc107; border-radius:8px; padding:15px; margin-bottom:20px;">
            <p style="margin:0; color:#856404; font-weight:600;">⚠️ Security Reminder: Never enter your actual password in training or unknown forms!</p>
          </div>
          
          <label style="display:block; margin-bottom:10px; font-weight:600; color:#333;">Password Strength Tester:</label>
          <input type="text" 
                 id="passwordInput" 
                 placeholder="Click an example below to test..." 
                 readonly
                 onfocus="showPasswordWarning()"
                 style="width:100%; padding:12px; font-size:16px; border:2px solid #ddd; border-radius:6px; margin-bottom:20px; background:#f8f9fa;">
          
          <div style="margin-bottom:20px;">
            <p style="font-weight:600; color:#333; margin-bottom:10px;">🧪 Click each password to test its strength:</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <button onclick="testPassword('password')" style="padding:12px; border:1px solid #ddd; border-radius:6px; background:#fff; cursor:pointer; font-family:monospace;">
                password
              </button>
              <button onclick="testPassword('Password123')" style="padding:12px; border:1px solid #ddd; border-radius:6px; background:#fff; cursor:pointer; font-family:monospace;">
                Password123
              </button>
              <button onclick="testPassword('Secure@2024')" style="padding:12px; border:1px solid #ddd; border-radius:6px; background:#fff; cursor:pointer; font-family:monospace;">
                Secure@2024
              </button>
              <button onclick="testPassword('Coffee#Sunrise&Mountain47!')" style="padding:12px; border:1px solid #ddd; border-radius:6px; background:#fff; cursor:pointer; font-family:monospace;">
                Coffee#Sunrise&Mountain47!
              </button>
            </div>
          </div>
          
          <div style="background:#f0f0f0; height:12px; border-radius:6px; overflow:hidden; margin-bottom:15px;">
            <div id="strengthBar" style="height:100%; width:0%; transition:all 0.3s ease;"></div>
          </div>
          
          <div id="strengthFeedback" style="font-weight:600; text-align:center; margin-bottom:20px; min-height:24px;"></div>
          
          <div style="background:rgba(123,44,191,0.1); padding:16px; border-radius:6px;">
            <p style="margin:0; font-size:14px;"><strong>💡 Password Requirements:</strong></p>
            <ul style="margin:10px 0 0 20px; font-size:14px;">
              <li id="req-length" style="color:#999;">At least 12 characters</li>
              <li id="req-upper" style="color:#999;">Include uppercase letters</li>
              <li id="req-lower" style="color:#999;">Include lowercase letters</li>
              <li id="req-number" style="color:#999;">Include numbers</li>
              <li id="req-special" style="color:#999;">Include special characters (!@#$%^&*)</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div id="passwordCompleteFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()" id="passwordContinue" style="display:none;">Continue →</button>
      </div>
    </div>

    <!-- Slide 8: Software Compliance Principles -->
    <div class="slide" id="slide8">
      <h2>⚖️ Software Compliance & Security</h2>
      <p>Unapproved software is a major security risk. Every tool must be vetted before use.</p>
      
      <div class="info-cards">
        <div class="info-card">
          <span class="info-card-icon">🔍</span>
          <h3>Security Review</h3>
          <p>All software must pass security team review for vulnerabilities and backdoors</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">📜</span>
          <h3>License Check</h3>
          <p>Ensure licenses are compatible with your organization's use requirements</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🛠️</span>
          <h3>Keep Everything Updated</h3>
          <p>Install security patches promptly - outdated software is an open door for attackers</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🚫</span>
          <h3>Shadow IT Risk</h3>
          <p>Unapproved tools can introduce malware, data leaks, and compliance violations</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">✅</span>
          <h3>Approved Software</h3>
          <p>Check your organization's approved software list before installing any new tools</p>
        </div>
        <div class="info-card">
          <span class="info-card-icon">🤖</span>
          <h3>AI Tool Usage</h3>
          <p>Only use approved AI tools - never share company code, data, or internal information with unauthorized AI services</p>
        </div>
      </div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="nextSlide()">Next →</button>
      </div>
    </div>

    <!-- Slide 9: Software Approval Simulation -->
    <div class="slide" id="slide9">
      <h2>🤖 AI Tool Installation Alert</h2>
      <p>IT Security detected an unauthorized AI assistant installed on compliance team computers:</p>
      
      <div class="simulation-box">
        <div class="website-simulator">
          <div class="browser-bar">
            <div class="browser-controls">
              <div class="browser-dot"></div>
              <div class="browser-dot"></div>
              <div class="browser-dot"></div>
            </div>
            <div class="url-bar">it-security@company.com</div>
          </div>
          <div class="website-content" style="background:#fff; padding:20px;">
            <div style="background:#fff3cd; border:2px solid #ffc107; border-radius:8px; padding:20px; margin-bottom:20px;">
              <h3 style="color:#856404; margin:0 0 10px 0;">⚠️ Unauthorized Software Alert</h3>
              <p style="color:#333; margin:10px 0;"><strong>Application:</strong> ComplianceAI Pro</p>
              <p style="color:#333; margin:10px 0;"><strong>Installed by:</strong> GRC Team (8 users)</p>
              <p style="color:#333; margin:10px 0;"><strong>Description:</strong> AI-powered audit automation and compliance reporting tool</p>
              <p style="color:#333; margin:10px 0;"><strong>Critical Security Concerns:</strong></p>
              <ul style="color:#d73502; margin-left:20px;">
                <li>Uploads the company's internal audit data and security policies to external AI servers</li>
                <li>Stores compliance reports in third-party cloud without encryption</li>
                <li>No SOC 2 certification or data processing agreement</li>
                <li>Browser extension accesses all internal documentation</li>
                <li>Free trial converting to $149/month per user</li>
              </ul>
            </div>
            <p style="font-weight:600; color:#333;">GRC Director says: "This AI tool reduced our audit prep time by 60%! We need this for our upcoming SOC 2 renewal!"</p>
          </div>
        </div>
        
        <p style="text-align:center; font-weight:600; margin-top:24px;">What's the correct action?</p>
      </div>
      
      <div class="decision-grid">
        <button class="decision-btn" onclick="softwareDecision('keep')" id="soft-keep">Keep it - GRC needs it for audits</button>
        <button class="decision-btn" onclick="softwareDecision('remove')" id="soft-remove">Uninstall and work with IT on approved solution</button>
        <button class="decision-btn" onclick="softwareDecision('isolate')" id="soft-isolate">Let GRC keep using while we evaluate</button>
        <button class="decision-btn" onclick="softwareDecision('wait')" id="soft-wait">Get legal approval first</button>
      </div>
      
      <div id="softwareFeedback" style="margin-top:24px;"></div>
      
      <div class="navigation">
        <button class="btn btn-secondary" onclick="previousSlide()">← Back</button>
        <button class="btn" onclick="completeTraining()" id="softwareContinue" style="display:none;">Complete Training →</button>
      </div>
    </div>
    
    <!-- Slide 10: Certificate -->
    <div class="slide" id="slide10">
      <div class="certificate">
        <div class="trophy-icon">🏆</div>
        <h1 style="color:var(--primary-purple); margin:24px 0;">Cybersecurity Champion!</h1>
        <p style="font-size:1.25rem; color:var(--dark-purple); margin-bottom:32px;">
          You've mastered essential cybersecurity practices!
        </p>
        
        <div style="margin:32px 0;">
          <div>
            <div style="font-size:2rem; font-weight:700; color:var(--primary-purple);" id="finalScore">100%</div>
            <div style="color:#6c757d;">Final Score</div>
          </div>
        </div>
        
        <p style="color:var(--primary-purple); font-weight:600; font-size:1.125rem;">
          Stay Vigilant. Stay Secure. 👾
        </p>
        
        <button class="btn" onclick="window.close()" style="margin-top:24px;">Exit Training</button>
      </div>
    </div>
  </div>

  <div class="scorm-status" id="scormStatus">SCORM: Disconnected</div>

  <script>
    // SCORM API wrapper
    var scorm = {
      version: null, api: null,
      init: function() {
        try {
          this.api = this.getAPI();
          if (this.api) {
            this.version = this.getVersion();
            var result = this.api.LMSInitialize ? this.api.LMSInitialize("") : this.api.Initialize("");
            if (result == "true") {
              this.setStatus("initialized");
              this.setValue("cmi.core.lesson_status", "incomplete");
              this.setValue("cmi.core.score.min", "0");
              this.setValue("cmi.core.score.max", "100");
              this.setValue("cmi.core.score.raw", "0");
              this.commit();
              return true;
            }
          }
        } catch(e) { console.log("SCORM API not available - standalone mode"); }
        return false;
      },
      getAPI: function() {
        var api=null; if (window.parent && window.parent!=window) api=this.findAPI(window.parent);
        if (!api && window.opener) api=this.findAPI(window.opener);
        if (!api) api=this.findAPI(window);
        return api;
      },
      findAPI: function(win) {
        var i=0; while(!win.API && !win.API_1484_11 && win.parent && win.parent!=win && i<500){ i++; win=win.parent; }
        return win.API || win.API_1484_11;
      },
      getVersion: function(){ if(this.api){ if(this.api.LMSInitialize) return "1.2"; if(this.api.Initialize) return "2004";} return null; },
      getValue: function(e){ if(!this.api) return ""; return this.version=="1.2"? this.api.LMSGetValue(e): this.api.GetValue(e); },
      setValue: function(e,v){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSSetValue(e,v): this.api.SetValue(e,v); },
      commit: function(){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSCommit(""): this.api.Commit(""); },
      finish: function(){ if(!this.api) return false; return this.version=="1.2"? this.api.LMSFinish(""): this.api.Terminate(""); },
      setStatus: function(status){ var el=document.getElementById('scormStatus'); if(el){ el.textContent='SCORM: '+status; el.style.display='block'; } }
    };
    
    // Game state management
    let gameState = {
      currentSlide: 1,
      totalSlides: 10,
      userScore: 0,
      achievements: [],
      ransomwareComplete: false,
      lockComplete: false,
      passwordComplete: false,
      softwareComplete: false,
      scenariosCompleted: 0,
      totalScenarios: 4,
      choices: {}
    };
    
    
    // Achievement system
    function showAchievement(icon, title, text) {
      const popup = document.getElementById('achievementPopup');
      document.getElementById('achievementIcon').textContent = icon;
      document.getElementById('achievementTitle').textContent = title;
      document.getElementById('achievementText').textContent = text;
      
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 3000);
    }
    
    // Ransomware Decision Handler
    function ransomwareDecision(choice) {
      const ransomKey = `ransomware_decision`;
      
      const feedbackDiv = document.getElementById('ransomwareFeedback');
      const buttons = document.querySelectorAll('#slide3 .decision-btn');
      
      // Save the choice
      gameState.choices[ransomKey] = choice;
      saveChoice(ransomKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Clear all button styling and indicators first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
        btn.style.transform = '';
        btn.style.boxShadow = '';
        btn.style.position = '';
        btn.style.zIndex = '';
        // Remove any existing indicators
        const existingIndicator = btn.querySelector('.action-indicator');
        if (existingIndicator) existingIndicator.remove();
        const existingLabel = btn.querySelector('.action-label');
        if (existingLabel) existingLabel.remove();
      });
      
      // Find the clicked button
      let clickedButton;
      buttons.forEach(btn => {
        if ((choice === 'wait' && btn.textContent.includes('Wait and document')) ||
            (choice === 'disconnect' && btn.textContent.includes('Report to security@yourcompany.com')) ||
            (choice === 'restart' && btn.textContent.includes('Restart to stop')) ||
            (choice === 'antivirus' && btn.textContent.includes('Run security scan'))) {
          clickedButton = btn;
        }
      });
      
      // Make non-selected buttons slightly faded but still readable
      buttons.forEach(btn => {
        if (btn !== clickedButton) {
          btn.style.opacity = '0.7';
          btn.style.transform = 'scale(0.98)';
        }
      });
      
      switch(choice) {
        case 'wait':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ NO! Every second counts! Ransomware is actively encrypting files and exfiltrating data RIGHT NOW!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'disconnect':
          feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ CORRECT! Your immediate priority is to engage Security to contain the attack!<br><br>
            <strong>Why reporting to Security is critical:</strong><br>
            • Security team can isolate affected systems across the network<br>
            • They have tools to stop the attack and preserve evidence<br>
            • Professional incident response minimizes damage and data loss<br><br>
            <strong>Report immediately to:</strong><br>
            • Email: <code style="background:#e3f2fd;padding:2px 6px;border-radius:4px;">security@yourcompany.com</code><br>
            • Slack: <code style="background:#e3f2fd;padding:2px 6px;border-radius:4px;">#security-team</code><br><br>
            After reporting, follow Security team's instructions - they may ask you to disconnect network or take other actions.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #2E7D32';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(76,175,80,0.4), 0 0 25px rgba(76,175,80,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '✅';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #4CAF50;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          showAchievement('🛡️', 'Incident Response Hero', 'Prevented ransomware spread!');
          gameState.ransomwareComplete = true;
          document.getElementById('ransomwareContinue').style.display = 'inline-flex';
          document.querySelectorAll('#slide3 .decision-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('disabled');
          });
          break;
        case 'restart':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ NEVER restart during an attack! This could trigger encryption of remaining files or lose forensic evidence!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'antivirus':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Wrong priority! Report to Security FIRST! They need to coordinate the response - contact security@yourcompany.com or #security-team immediately!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
      }
    }
    
    function showWarning() {
      alert('🚨 NEVER install plugins from websites! This is how watering hole attacks spread malware.');
    }
    
    // URL detection game
    // Move urlsChecked to gameState for proper persistence
    function checkURL(element, url, isSuspicious) {
      if (!gameState.urlsChecked) gameState.urlsChecked = [];
      
      // Check if already clicked - if so, just show feedback
      if (gameState.urlsChecked.includes(url)) {
        // Already checked - just show the visual feedback again
        if (isSuspicious) {
          alert('✅ You already identified this suspicious URL!');
        } else {
          alert('✅ You already checked this legitimate URL.');
        }
        return;
      }
      
      gameState.urlsChecked.push(url);
      const urlKey = `url_${url}`;
      gameState.choices[urlKey] = true;
      saveChoice(urlKey, true);
      
      if (isSuspicious) {
        element.classList.add('correct');
        gameState.urlsFound++;
        
        if (gameState.urlsFound === 1) {
          showAchievement('👁️', 'Sharp Eye', 'Found your first suspicious URL!');
        }
      } else {
        element.classList.add('incorrect');
      }
      
      document.getElementById('urlScore').textContent = gameState.urlsFound + '/' + gameState.totalSuspiciousUrls;
      
      if (gameState.urlsFound === gameState.totalSuspiciousUrls) {
        showAchievement('🔍', 'URL Master', 'Found all suspicious URLs!');
        document.getElementById('urlContinue').style.display = 'inline-flex';
      }
    }
    
    // Response simulation
    
    // Lock Decision Handler
    function lockDecision(choice) {
      const lockKey = `lock_decision`;
      
      const feedbackDiv = document.getElementById('lockFeedback');
      const buttons = document.querySelectorAll('#slide5 .decision-btn');
      
      // Save the choice
      gameState.choices[lockKey] = choice;
      saveChoice(lockKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Clear all button styling and indicators first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
        btn.style.transform = '';
        btn.style.boxShadow = '';
        btn.style.position = '';
        btn.style.zIndex = '';
        // Remove any existing indicators
        const existingIndicator = btn.querySelector('.action-indicator');
        if (existingIndicator) existingIndicator.remove();
        const existingLabel = btn.querySelector('.action-label');
        if (existingLabel) existingLabel.remove();
      });
      
      // Find the clicked button
      let clickedButton;
      buttons.forEach(btn => {
        if ((choice === 'quick' && btn.textContent.includes("They're friends")) ||
            (choice === 'lock' && btn.textContent.includes('Lock screen')) ||
            (choice === 'ask' && btn.textContent.includes('Ask friends')) ||
            (choice === 'take' && btn.textContent.includes('Take laptop'))) {
          clickedButton = btn;
        }
      });
      
      // Make non-selected buttons slightly faded but still readable
      buttons.forEach(btn => {
        if (btn !== clickedButton) {
          btn.style.opacity = '0.7';
          btn.style.transform = 'scale(0.98)';
        }
      });
      
      switch(choice) {
        case 'quick':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Even friends shouldn't have access to the company's confidential data! Always lock your work devices.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'lock':
          feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ Excellent! Always lock your screen when stepping away. Win+L or Cmd+Ctrl+Q takes 1 second!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #2E7D32';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(76,175,80,0.4), 0 0 25px rgba(76,175,80,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '✅';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #4CAF50;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          showAchievement('🔒', 'Lock Master', 'Protected sensitive organizational data!');
          gameState.lockComplete = true;
          document.getElementById('lockContinue').style.display = 'inline-flex';
          document.querySelectorAll('#slide5 .decision-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('disabled');
          });
          break;
        case 'ask':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Asking friends not to look isn't security! They could accidentally see or share confidential information.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'take':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Impractical! Always lock your screen - it's faster and more secure. Just Win+L or Cmd+Ctrl+Q!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
      }
    }
    
    // Test Password Function
    function testPassword(password) {
      document.getElementById('passwordInput').value = password;
      checkPasswordStrength();
    }
    
    // Show Warning if User Tries to Type
    function showPasswordWarning() {
      const popupHTML = `
        <div id="passwordWarningPopup" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0); display: flex; align-items: center; justify-content: center; z-index: 2000; transition: background 0.3s ease;">
          <div id="passwordWarningContent" style="background: white; border-radius: 16px; width: 90%; max-width: 500px; padding: 40px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 3px solid #f44336; transform: scale(0.7); opacity: 0; transition: all 0.3s ease;">
            <div style="font-size: 64px; margin-bottom: 20px;">🚫</div>
            <h2 style="color: #f44336; margin-bottom: 16px;">STOP!</h2>
            <p style="color: #333; font-size: 18px; margin-bottom: 24px; line-height: 1.6; font-weight: 600;">
              Never type your real password anywhere sketchy!
            </p>
            <p style="color: #666; font-size: 16px; margin-bottom: 24px; line-height: 1.6;">
              This is a training exercise. Use the example passwords provided below to test password strength. Never enter your actual passwords in training modules or unknown websites.
            </p>
            <button onclick="closePasswordWarningPopup()" style="background: #f44336; color: white; border: none; padding: 14px 36px; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600; transition: all 0.2s ease;">
              I Understand
            </button>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', popupHTML);

      // Trigger animation immediately
      requestAnimationFrame(() => {
        const popup = document.getElementById('passwordWarningPopup');
        const content = document.getElementById('passwordWarningContent');
        if (popup && content) {
          popup.style.background = 'rgba(0,0,0,0.8)';
          content.style.transform = 'scale(1)';
          content.style.opacity = '1';
        }
      });

      // Clear the input field
      setTimeout(() => {
        document.getElementById('passwordInput').value = '';
        document.getElementById('strengthBar').style.width = '0%';
        document.getElementById('strengthFeedback').textContent = '';
        // Reset requirement colors
        document.getElementById('req-length').style.color = '#999';
        document.getElementById('req-upper').style.color = '#999';
        document.getElementById('req-lower').style.color = '#999';
        document.getElementById('req-number').style.color = '#999';
        document.getElementById('req-special').style.color = '#999';
      }, 100);
    }

    function closePasswordWarningPopup() {
      const popup = document.getElementById('passwordWarningPopup');
      const content = document.getElementById('passwordWarningContent');

      if (popup && content) {
        // Animate out
        popup.style.background = 'rgba(0,0,0,0)';
        content.style.transform = 'scale(0.7)';
        content.style.opacity = '0';

        // Remove after animation completes
        setTimeout(() => {
          popup.remove();
        }, 300);
      }
      document.getElementById('passwordInput').blur();
    }
    
    // Password Strength Checker
    function checkPasswordStrength() {
      const password = document.getElementById('passwordInput').value;
      const strengthBar = document.getElementById('strengthBar');
      const feedback = document.getElementById('strengthFeedback');
      const completeFeedback = document.getElementById('passwordCompleteFeedback');
      
      let strength = 0;
      let strengthText = '';
      let strengthColor = '';
      let barWidth = '0%';
      
      // Check requirements
      const hasLength = password.length >= 12;
      const hasUpper = /[A-Z]/.test(password);
      const hasLower = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecial = /[^a-zA-Z0-9]/.test(password);
      
      // Update requirement indicators
      document.getElementById('req-length').style.color = hasLength ? '#4CAF50' : '#999';
      document.getElementById('req-upper').style.color = hasUpper ? '#4CAF50' : '#999';
      document.getElementById('req-lower').style.color = hasLower ? '#4CAF50' : '#999';
      document.getElementById('req-number').style.color = hasNumber ? '#4CAF50' : '#999';
      document.getElementById('req-special').style.color = hasSpecial ? '#4CAF50' : '#999';
      
      // Calculate strength
      if (hasLength) strength += 2;
      else if (password.length >= 8) strength += 1;
      
      if (hasLower) strength += 1;
      if (hasUpper) strength += 1;
      if (hasNumber) strength += 1;
      if (hasSpecial) strength += 1;
      
      // Common patterns check
      if (password.length > 0 && !/password|123456|qwerty|welcome|admin/i.test(password)) {
        strength += 1;
      }
      
      // Determine strength level
      if (password.length === 0) {
        strengthText = '';
        strengthColor = '#ddd';
        barWidth = '0%';
      } else if (strength <= 2) {
        strengthText = '❌ Weak';
        strengthColor = '#f44336';
        barWidth = '25%';
        strengthBar.style.background = 'linear-gradient(90deg, #f44336, #C62828)';
      } else if (strength <= 4) {
        strengthText = '⚠️ Medium';
        strengthColor = '#ff9800';
        barWidth = '50%';
        strengthBar.style.background = 'linear-gradient(90deg, #ff9800, #E65100)';
      } else if (strength <= 6) {
        strengthText = '👍 Strong';
        strengthColor = '#8BC34A';
        barWidth = '75%';
        strengthBar.style.background = 'linear-gradient(90deg, #8BC34A, #689F38)';
      } else {
        strengthText = '💪 Very Strong';
        strengthColor = '#4CAF50';
        barWidth = '100%';
        strengthBar.style.background = 'linear-gradient(90deg, #4CAF50, #2E7D32)';
        
        // Check if they tested a strong password example
        if (hasLength && hasUpper && hasLower && hasNumber && hasSpecial) {
          // Show success for very strong passwords
          if (!gameState.passwordComplete && password === 'Coffee#Sunrise&Mountain47!') {
            completeFeedback.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ Excellent! You've discovered what makes a Very Strong password!<br>
              • Length + uppercase + lowercase + numbers + symbols = maximum security<br>
              • Use passphrases or a password manager for all accounts<br>
              • NEVER reuse passwords across different services
            </div>`;
            showAchievement('🔐', 'Password Expert', 'Learned to identify strong passwords!');
            gameState.passwordComplete = true;
            document.getElementById('passwordContinue').style.display = 'inline-flex';
            
            // Save the achievement
            const passKey = 'password_strength_achieved';
            gameState.choices[passKey] = true;
            saveChoice(passKey, true);
          }
        }
      }
      
      // Update UI
      strengthBar.style.width = barWidth;
      feedback.textContent = strengthText;
      feedback.style.color = strengthColor;
    }
    
    // Software Compliance Decision Handler
    function softwareDecision(choice) {
      const softKey = `software_decision`;
      
      const feedbackDiv = document.getElementById('softwareFeedback');
      const buttons = document.querySelectorAll('#slide9 .decision-btn');
      
      // Save the choice
      gameState.choices[softKey] = choice;
      saveChoice(softKey, choice);
      
      feedbackDiv.innerHTML = '';
      
      // Clear all button styling and indicators first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
        btn.style.transform = '';
        btn.style.boxShadow = '';
        btn.style.position = '';
        btn.style.zIndex = '';
        // Remove any existing indicators
        const existingIndicator = btn.querySelector('.action-indicator');
        if (existingIndicator) existingIndicator.remove();
        const existingLabel = btn.querySelector('.action-label');
        if (existingLabel) existingLabel.remove();
      });
      
      // Find the clicked button
      let clickedButton;
      buttons.forEach(btn => {
        if ((choice === 'keep' && btn.textContent.includes('GRC needs it')) ||
            (choice === 'remove' && btn.textContent.includes('Uninstall and work')) ||
            (choice === 'isolate' && btn.textContent.includes('keep using while')) ||
            (choice === 'wait' && btn.textContent.includes('legal approval'))) {
          clickedButton = btn;
        }
      });
      
      // Make non-selected buttons slightly faded but still readable
      buttons.forEach(btn => {
        if (btn !== clickedButton) {
          btn.style.opacity = '0.7';
          btn.style.transform = 'scale(0.98)';
        }
      });
      
      switch(choice) {
        case 'keep':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ NO! This AI tool is exposing the company's sensitive audit data and security policies to external servers without proper agreements!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'remove':
          feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ Excellent! Uninstall immediately and work with IT to find an approved AI solution that protects customer data.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #2E7D32';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(76,175,80,0.4), 0 0 25px rgba(76,175,80,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '✅';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #4CAF50;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          showAchievement('⚖️', 'Compliance Champion', 'Following proper software approval process!');
          gameState.softwareComplete = true;
          document.getElementById('softwareContinue').style.display = 'inline-flex';
          document.querySelectorAll('#slide9 .decision-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('disabled');
          });
          break;
        case 'isolate':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Too risky! Customer data is already being uploaded. Must remove immediately!
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
        case 'wait':
          feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
            ❌ Wrong priority! Data is being leaked NOW. Remove first, then handle legal/compliance issues.
          </div>`;
          if (clickedButton) {
            clickedButton.style.background = 'linear-gradient(135deg, #f44336, #C62828)';
            clickedButton.style.color = 'white';
            clickedButton.style.fontWeight = 'bold';
            clickedButton.style.border = '4px solid #C62828';
            clickedButton.style.transform = 'scale(1.12)';
            clickedButton.style.boxShadow = '0 8px 30px rgba(244,67,54,0.4), 0 0 25px rgba(244,67,54,0.3)';
            clickedButton.style.opacity = '1';
            clickedButton.style.position = 'relative';
            clickedButton.style.zIndex = '100';
            
            const icon = document.createElement('span');
            icon.className = 'action-indicator';
            icon.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
            icon.textContent = '❌';
            clickedButton.insertBefore(icon, clickedButton.firstChild);
            
            const label = document.createElement('div');
            label.className = 'action-label';
            label.style.cssText = `
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);
              background: #f44336;
              color: white;
              padding: 4px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: bold;
              white-space: nowrap;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            label.textContent = '🎯 YOUR CHOICE';
            clickedButton.appendChild(label);
          }
          break;
      }
    }
    
    // Knowledge check scenarios
    function loadScenarios() {
      const scenarios = [
        {
          title: 'Malware Prevention',
          type: 'malware',
          description: 'A colleague receives a USB from a conference labeled "Conference Workshop Materials". What should they do?',
          options: [
            { text: 'Plug it into their work computer to check the contents', feedback: 'Never plug unknown USBs into work computers - they can auto-execute malware.', correct: false },
            { text: 'Report it to security@yourcompany.com for proper scanning', feedback: 'Correct! Security team has isolated systems to safely check unknown devices.', correct: true },
            { text: 'Use a personal laptop to check it first', feedback: 'Personal devices can still spread malware to corporate networks.', correct: false }
          ]
        },
        {
          title: 'Device Security',
          type: 'device',
          description: 'You\'re in a conference room for a 5-minute break. Your laptop shows confidential company architecture. What do you do?',
          options: [
            { text: 'Ask a colleague to watch it while you\'re gone', feedback: 'Even trusted colleagues shouldn\'t have unsupervised access.', correct: false },
            { text: 'Leave it open since it\'s just 5 minutes', feedback: 'Never leave devices unlocked - attacks happen in seconds.', correct: false },
            { text: 'Lock the screen using Win+L or Cmd+Ctrl+Q', feedback: 'Perfect! Always lock screens when stepping away, even briefly.', correct: true }
          ]
        },
        {
          title: 'Password Security',
          type: 'password',
          description: 'Your team needs to share access to a shared organization account. Best approach?',
          options: [
            { text: 'Share the password via encrypted email', feedback: 'Never share passwords via email, even encrypted.', correct: false },
            { text: 'Use organization\'s SSO and grant individual access permissions', feedback: 'Excellent! SSO provides individual accountability and security.', correct: true },
            { text: 'Store the password in a shared document', feedback: 'Shared documents are not secure for password storage.', correct: false }
          ]
        },
        {
          title: 'Software Compliance',
          type: 'software',
          description: 'A developer wants to use a new code analysis tool they found online. What\'s the correct process?',
          options: [
            { text: 'Install it immediately if it\'s open source', feedback: 'Open source doesn\'t mean safe - needs security review.', correct: false },
            { text: 'Test it on a personal device first', feedback: 'Personal testing doesn\'t validate security for corporate use.', correct: false },
            { text: 'Submit it for security review before installation', feedback: 'Correct! All software needs security review before use.', correct: true }
          ]
        }
      ];
      
      const container = document.getElementById('scenarioContainer');
      
      // Clear existing scenarios to prevent duplicates
      container.innerHTML = '';
      
      scenarios.forEach((scenario, index) => {
        const scenarioDiv = document.createElement('div');
        scenarioDiv.style.cssText = 'background:#f8f9fa;padding:24px;border-radius:12px;margin-bottom:24px;border:2px solid #dee2e6;';
        
        const icon = scenario.type === 'plugin' ? '🔌' : scenario.type === 'redirect' ? '🔄' : '🚨';
        
        scenarioDiv.innerHTML = `
          <h3 style="color:var(--dark-purple);margin-bottom:16px;">${icon} Scenario ${index + 1}: ${scenario.title}</h3>
          <p style="margin-bottom:20px;font-style:italic;">${scenario.description}</p>
          <div id="scenario${index}Options" style="display:grid;gap:12px;">
            ${scenario.options.map((opt, i) => 
              `<button class="btn btn-secondary" style="text-align:left;padding:16px;" onclick="scenarioResponse(${index}, ${i})">${opt.text}</button>`
            ).join('')}
          </div>
          <div id="scenario${index}Feedback" style="margin-top:16px;"></div>
        `;
        
        container.appendChild(scenarioDiv);
      });
    }
    
    function scenarioResponse(scenarioIndex, optionIndex) {
      const choiceKey = `scenario_${scenarioIndex}`;
      
      // Save the choice
      gameState.choices[choiceKey] = optionIndex;
      saveChoice(choiceKey, optionIndex);
      const scenarios = [
        {
          options: [
            { feedback: 'Correct — malicious prompts on trusted sites are a hallmark of watering hole attacks.', correct: true },
            { feedback: 'Hangs can happen for many benign reasons. Not sufficient by itself.', correct: false },
            { feedback: 'Maintenance happens; not evidence of compromise on its own.', correct: false }
          ]
        },
        {
          options: [
            { feedback: 'Appearance can be spoofed; don\'t trust looks alone.', correct: false },
            { feedback: 'Correct — verify the URL and use trusted bookmarks to avoid look‑alike domains.', correct: true },
            { feedback: 'Never enter credentials on a suspicious page.', correct: false }
          ]
        },
        {
          options: [
            { feedback: 'Correct — report to Security and isolate impacted systems.', correct: true },
            { feedback: 'Public posts can tip attackers or cause confusion; use internal channels.', correct: false },
            { feedback: 'Never install unverified updates suggested by websites.', correct: false }
          ]
        }
      ];
      
      const scenario = scenarios[scenarioIndex];
      const option = scenario.options[optionIndex];
      const feedbackDiv = document.getElementById(`scenario${scenarioIndex}Feedback`);
      const buttons = document.querySelectorAll(`#scenario${scenarioIndex}Options button`);
      
      // Clear previous styling from all buttons first
      buttons.forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
        btn.style.fontWeight = '';
        btn.style.border = '';
        btn.style.opacity = '';
      });
      
      // Highlight the selected button
      buttons[optionIndex].style.background = option.correct ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 'linear-gradient(135deg, #ff9800, #f57c00)';
      buttons[optionIndex].style.color = 'white';
      buttons[optionIndex].style.fontWeight = '600';
      buttons[optionIndex].style.border = option.correct ? '2px solid #4CAF50' : '2px solid #ff9800';
      
      if (option.correct) {
        feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
          ✅ ${option.feedback}
        </div>`;
        
        // Disable all buttons for this scenario ONLY after correct answer
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.classList.add('disabled');
        });
        
        if (!gameState.scenariosCompleted) gameState.scenariosCompleted = 0;
        gameState.scenariosCompleted++;
        
        if (gameState.scenariosCompleted === gameState.totalScenarios) {
          document.getElementById('completeBtn').style.display = 'inline-flex';
          if (!gameState.achievements.includes('scenario_master')) {
            gameState.achievements.push('scenario_master');
            showAchievement('🎯', 'Scenario Master', 'Completed all knowledge checks!');
          }
        }
      } else {
        feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
          ❌ ${option.feedback} Try again!
        </div>`;
        // Mark the incorrect button with orange but keep enabled
        buttons[optionIndex].style.opacity = '0.7';
      }
    }
    
    // Navigation
    function updateProgress() {
      document.getElementById('progressBar').style.width = (gameState.currentSlide / gameState.totalSlides) * 100 + '%';
    }
    
    function showSlide(n) {
      document.querySelectorAll('.slide').forEach(slide => slide.classList.remove('active'));
      document.getElementById('slide' + n).classList.add('active');
      gameState.currentSlide = n;
      updateProgress();
      updateSCORM();
      
      // Notify parent frame if embedded
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'slideChange',
          slide: n,
          module: 'general'
        }, '*');
      }
      
      // Restore choices when reaching decision slides
      if ([3, 5, 7, 9].includes(n)) {
        if (gameState.choices && Object.keys(gameState.choices).length > 0) {
          setTimeout(restoreChoices, 50);
        }
      }
    }
    
    function nextSlide() {
      if (gameState.currentSlide < gameState.totalSlides) {
        showSlide(gameState.currentSlide + 1);
      }
    }
    
    function previousSlide() {
      if (gameState.currentSlide > 1) {
        showSlide(gameState.currentSlide - 1);
      }
    }
    
    function startTraining() {
      showAchievement('🚀', 'Training Started!', 'Your cybersecurity journey begins!');
      nextSlide();
    }
    
    // Completion
    function completeTraining() {
      
      // Calculate completion score based on simulations only
      let totalActivities = 4; // 4 simulations (USB, Lock, Password, Software)
      let completedActivities = 0;
      
      // Add simulation completions
      if (gameState.ransomwareComplete) completedActivities++;
      if (gameState.lockComplete) completedActivities++;
      if (gameState.passwordComplete) completedActivities++;
      if (gameState.softwareComplete) completedActivities++;
      
      const finalScore = Math.round((completedActivities / totalActivities) * 100);
      
      document.getElementById('finalScore').textContent = finalScore + '%';
      
      // Notify parent frame if embedded
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'moduleComplete',
          module: 'general'
        }, '*');
      }
      
      // Update SCORM
      scorm.setValue('cmi.core.score.raw', String(finalScore));
      scorm.setValue('cmi.core.lesson_status', finalScore >= 80 ? 'passed' : 'completed');
      scorm.commit();
      
      showSlide(10);
      launchConfetti();
      showAchievement('🏆', 'Training Complete!', 'You are now a Cybersecurity Champion!');
    }
    
    function launchConfetti() {
      const container = document.getElementById('confettiContainer');
      container.style.display = 'block';
      const colors = ['#7B2CBF', '#4CAF50', '#FFD700', '#FF6B6B', '#4ECDC4'];
      
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = (Math.random() * 10 + 5) + 'px';
          confetti.style.height = confetti.style.width;
          confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          container.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 4000);
        }, i * 30);
      }
    }
    
    // Update SCORM
    // Choice persistence functions
    function saveChoice(slideId, choice) {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({
          type: 'choiceUpdate',
          slideId: slideId,
          choice: choice,
          choicesData: {
            choices: gameState.choices,
            scenariosCompleted: gameState.scenariosCompleted || 0,
            urlsChecked: gameState.urlsChecked || []
          }
        }, '*');
      }
    }
    
    function restoreChoices() {
      const choicesData = gameState.choices || {};
      
      // Add restoring class to prevent flicker
      const currentSlideElement = document.getElementById('slide' + gameState.currentSlide);
      if (currentSlideElement) {
        currentSlideElement.classList.add('restoring');
        setTimeout(() => {
          currentSlideElement.classList.remove('restoring');
        }, 200);
      }
      
      // Restore ransomware decision (slide 3)
      if (choicesData['ransomware_decision'] && gameState.currentSlide === 3) {
        const choice = choicesData['ransomware_decision'];
        const feedbackDiv = document.getElementById('ransomwareFeedback');
        const buttons = document.querySelectorAll('#slide3 .decision-btn');
        
        // Find the selected button
        let selectedButton = null;
        buttons.forEach(btn => {
          if ((choice === 'wait' && btn.textContent.includes('Wait and document')) ||
              (choice === 'disconnect' && btn.textContent.includes('Report to security@yourcompany.com')) ||
              (choice === 'restart' && btn.textContent.includes('Restart')) ||
              (choice === 'antivirus' && btn.textContent.includes('Run security'))) {
            selectedButton = btn;
          }
        });
        
        if (selectedButton && feedbackDiv) {
          // Apply visual restoration
          buttons.forEach(btn => {
            if (btn !== selectedButton) {
              btn.style.opacity = '0.7';
              btn.style.transform = 'scale(0.98)';
            }
          });
          
          const isCorrect = choice === 'disconnect';
          const color = isCorrect ? '#4CAF50' : '#f44336';
          const darkColor = isCorrect ? '#2E7D32' : '#C62828';
          const icon = isCorrect ? '✅' : '❌';
          
          selectedButton.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
          selectedButton.style.color = 'white';
          selectedButton.style.fontWeight = 'bold';
          selectedButton.style.border = `4px solid ${darkColor}`;
          selectedButton.style.transform = 'scale(1.12)';
          selectedButton.style.boxShadow = `0 8px 30px ${color}66, 0 0 25px ${color}44`;
          selectedButton.style.opacity = '1';
          selectedButton.style.position = 'relative';
          selectedButton.style.zIndex = '100';
          
          // Remove any existing indicators first
          const existingIndicator = selectedButton.querySelector('.action-indicator');
          if (existingIndicator) existingIndicator.remove();
          const existingLabel = selectedButton.querySelector('.action-label');
          if (existingLabel) existingLabel.remove();
          
          // Add icon and label
          const iconEl = document.createElement('span');
          iconEl.className = 'action-indicator';
          iconEl.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
          iconEl.textContent = icon;
          selectedButton.insertBefore(iconEl, selectedButton.firstChild);
          
          const label = document.createElement('div');
          label.className = 'action-label';
          label.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: ${color};
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          label.textContent = '🎯 YOUR CHOICE';
          selectedButton.appendChild(label);
          
          // Show feedback
          if (choice === 'disconnect') {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ CORRECT! Your immediate priority is to engage Security to contain the attack!<br><br>
              <strong>Why reporting to Security is critical:</strong><br>
              • Security team can isolate affected systems across the network<br>
              • They have tools to stop the attack and preserve evidence<br>
              • Professional incident response minimizes damage and data loss<br><br>
              <strong>Report immediately to:</strong><br>
              • Email: <code style="background:#e3f2fd;padding:2px 6px;border-radius:4px;">security@yourcompany.com</code><br>
              • Slack: <code style="background:#e3f2fd;padding:2px 6px;border-radius:4px;">#security-team</code><br><br>
              After reporting, follow Security team's instructions - they may ask you to disconnect network or take other actions.
            </div>`;
            gameState.ransomwareComplete = true;
            // Show continue button
            document.getElementById('ransomwareContinue').style.display = 'inline-flex';
            // Disable all buttons after correct answer
            buttons.forEach(btn => {
              btn.disabled = true;
              if (btn !== selectedButton) {
                btn.style.opacity = '0.6';
              }
            });
          } else {
            feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
              ❌ Not the best choice. Try again!
            </div>`;
          }
        }
      }
      
      // Restore lock decision (slide 5)
      if (choicesData['lock_decision'] && gameState.currentSlide === 5) {
        const choice = choicesData['lock_decision'];
        const feedbackDiv = document.getElementById('lockFeedback');
        const buttons = document.querySelectorAll('#slide5 .decision-btn');
        
        // Find the selected button
        let selectedButton = null;
        buttons.forEach(btn => {
          if ((choice === 'quick' && btn.textContent.includes("They're friends")) ||
              (choice === 'lock' && btn.textContent.includes('Lock screen')) ||
              (choice === 'ask' && btn.textContent.includes('Ask friends')) ||
              (choice === 'take' && btn.textContent.includes('Take laptop'))) {
            selectedButton = btn;
          }
        });
        
        if (selectedButton && feedbackDiv) {
          // Apply visual restoration
          buttons.forEach(btn => {
            if (btn !== selectedButton) {
              btn.style.opacity = '0.7';
              btn.style.transform = 'scale(0.98)';
            }
          });
          
          const isCorrect = choice === 'lock';
          const color = isCorrect ? '#4CAF50' : '#f44336';
          const darkColor = isCorrect ? '#2E7D32' : '#C62828';
          const icon = isCorrect ? '✅' : '❌';
          
          selectedButton.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
          selectedButton.style.color = 'white';
          selectedButton.style.fontWeight = 'bold';
          selectedButton.style.border = `4px solid ${darkColor}`;
          selectedButton.style.transform = 'scale(1.12)';
          selectedButton.style.boxShadow = `0 8px 30px ${color}66, 0 0 25px ${color}44`;
          selectedButton.style.opacity = '1';
          selectedButton.style.position = 'relative';
          selectedButton.style.zIndex = '100';
          
          // Remove any existing indicators first
          const existingIndicator = selectedButton.querySelector('.action-indicator');
          if (existingIndicator) existingIndicator.remove();
          const existingLabel = selectedButton.querySelector('.action-label');
          if (existingLabel) existingLabel.remove();
          
          // Add icon and label
          const iconEl = document.createElement('span');
          iconEl.className = 'action-indicator';
          iconEl.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
          iconEl.textContent = icon;
          selectedButton.insertBefore(iconEl, selectedButton.firstChild);
          
          const label = document.createElement('div');
          label.className = 'action-label';
          label.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: ${color};
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          label.textContent = '🎯 YOUR CHOICE';
          selectedButton.appendChild(label);
          
          // Show feedback
          if (choice === 'lock') {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ Excellent! Always lock your screen when stepping away. Win+L or Cmd+Ctrl+Q takes 1 second!
            </div>`;
            gameState.lockComplete = true;
            // Show continue button
            document.getElementById('lockContinue').style.display = 'inline-flex';
            // Disable all buttons after correct answer
            buttons.forEach(btn => {
              btn.disabled = true;
              if (btn !== selectedButton) {
                btn.style.opacity = '0.6';
              }
            });
          } else {
            feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
              ❌ Not secure enough. Try again!
            </div>`;
          }
        }
      }
      
      // Restore password strength achieved (slide 7)
      if (choicesData['password_strength_achieved'] && gameState.currentSlide === 7) {
        gameState.passwordComplete = true;
        const completeFeedback = document.getElementById('passwordCompleteFeedback');
        if (completeFeedback) {
          completeFeedback.innerHTML = `<div class="feedback correct" style="display:block;">
            ✅ You've already completed the password strength exercise!
          </div>`;
          document.getElementById('passwordContinue').style.display = 'inline-flex';
        }
      }
      
      // Restore software decision (slide 9)
      if (choicesData['software_decision'] && gameState.currentSlide === 9) {
        const choice = choicesData['software_decision'];
        const feedbackDiv = document.getElementById('softwareFeedback');
        const buttons = document.querySelectorAll('#slide9 .decision-btn');
        
        // Find the selected button
        let selectedButton = null;
        buttons.forEach(btn => {
          if ((choice === 'keep' && btn.textContent.includes('GRC needs it')) ||
              (choice === 'remove' && btn.textContent.includes('Uninstall and work')) ||
              (choice === 'isolate' && btn.textContent.includes('keep using while')) ||
              (choice === 'wait' && btn.textContent.includes('legal approval'))) {
            selectedButton = btn;
          }
        });
        
        if (selectedButton && feedbackDiv) {
          // Apply visual restoration
          buttons.forEach(btn => {
            if (btn !== selectedButton) {
              btn.style.opacity = '0.7';
              btn.style.transform = 'scale(0.98)';
            }
          });
          
          const isCorrect = choice === 'remove';
          const color = isCorrect ? '#4CAF50' : '#f44336';
          const darkColor = isCorrect ? '#2E7D32' : '#C62828';
          const icon = isCorrect ? '✅' : '❌';
          
          selectedButton.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
          selectedButton.style.color = 'white';
          selectedButton.style.fontWeight = 'bold';
          selectedButton.style.border = `4px solid ${darkColor}`;
          selectedButton.style.transform = 'scale(1.12)';
          selectedButton.style.boxShadow = `0 8px 30px ${color}66, 0 0 25px ${color}44`;
          selectedButton.style.opacity = '1';
          selectedButton.style.position = 'relative';
          selectedButton.style.zIndex = '100';
          
          // Remove any existing indicators first
          const existingIndicator = selectedButton.querySelector('.action-indicator');
          if (existingIndicator) existingIndicator.remove();
          const existingLabel = selectedButton.querySelector('.action-label');
          if (existingLabel) existingLabel.remove();
          
          // Add icon and label
          const iconEl = document.createElement('span');
          iconEl.className = 'action-indicator';
          iconEl.style.cssText = 'margin-right: 12px; font-size: 1.6em; vertical-align: middle;';
          iconEl.textContent = icon;
          selectedButton.insertBefore(iconEl, selectedButton.firstChild);
          
          const label = document.createElement('div');
          label.className = 'action-label';
          label.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: ${color};
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          label.textContent = '🎯 YOUR CHOICE';
          selectedButton.appendChild(label);
          
          // Show feedback
          if (choice === 'remove') {
            feedbackDiv.innerHTML = `<div class="feedback correct" style="display:block;">
              ✅ Excellent! Uninstall immediately and work with IT to find an approved AI solution that protects customer data.
            </div>`;
            gameState.softwareComplete = true;
            // Show continue button
            document.getElementById('softwareContinue').style.display = 'inline-flex';
            // Disable all buttons after correct answer
            buttons.forEach(btn => {
              btn.disabled = true;
              if (btn !== selectedButton) {
                btn.style.opacity = '0.6';
              }
            });
          } else {
            feedbackDiv.innerHTML = `<div class="feedback incorrect" style="display:block;">
              ❌ This puts organizational data at risk. Try again!
            </div>`;
          }
        }
      }
    }
    
    function updateSCORM() {
      if (scorm.api) {
        scorm.setValue('cmi.core.lesson_location', String(gameState.currentSlide));
        scorm.setValue('cmi.suspend_data', JSON.stringify({
          currentSlide: gameState.currentSlide,
          achievements: gameState.achievements
        }));
        scorm.commit();
      }
    }
    
    // Listen for messages from parent frame
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'loadChoices') {
        if (event.data.choices) {
          gameState.choices = event.data.choices;
          gameState.scenariosCompleted = event.data.scenariosCompleted || 0;
          gameState.urlsChecked = event.data.urlsChecked || [];
          
          // Restore choices if on a decision slide
          if ([3, 5, 7, 9].includes(gameState.currentSlide)) {
            setTimeout(restoreChoices, 50);
          }
        }
      }
    });
    
    // Initialize
    window.onload = function() {
      
      // Check if SCORM should be disabled (when loaded in iframe)
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('scorm') !== 'disabled') {
        scorm.init();
      }
      
      // Check if we should resume from a specific slide
      const resumeSlide = urlParams.get('slide');
      if (resumeSlide && !isNaN(resumeSlide)) {
        gameState.currentSlide = parseInt(resumeSlide);
        // Show the correct slide immediately to avoid flash
        showSlide(gameState.currentSlide);
      }
      
      
      // Restore choices if provided
      const savedChoices = urlParams.get('choices');
      if (savedChoices) {
        try {
          const choicesData = JSON.parse(decodeURIComponent(savedChoices));
          if (choicesData.choices !== undefined) {
            gameState.choices = choicesData.choices;
            gameState.scenariosCompleted = choicesData.scenariosCompleted || 0;
            // Don't restore urlsChecked here - it will be rebuilt from choices
          } else {
            gameState.choices = choicesData;
          }
          // Don't restore here - will be done when reaching the specific slide
        } catch (e) {
          console.warn('Failed to parse saved choices:', e);
        }
      }
      
      updateProgress();
      updateSCORM();
      
      // If we're resuming on a slide with choices, restore them with minimal delay
      if ((gameState.currentSlide === 3 || gameState.currentSlide === 5 || gameState.currentSlide === 7 || gameState.currentSlide === 9) && savedChoices) {
        setTimeout(restoreChoices, 50);
      }
    };
    
    // Owl easter egg
    function owlClick() {
      const owl = document.querySelector('.grc-owl');
      owl.style.animation = 'none';
      setTimeout(() => {
        owl.style.animation = 'bounce 2s ease-in-out infinite, spin 0.5s ease';
      }, 10);
      if (!gameState.achievements.includes('owl')) {
        gameState.achievements.push('owl');
        showAchievement('👾', 'Wise Discovery!', 'You found the easter egg!');
      }
      // If in iframe, send message to parent to go home
      if (window.parent !== window) {
        window.parent.postMessage({ type: 'goHome' }, '*');
      }
    }
  </script>
</body>
</html>